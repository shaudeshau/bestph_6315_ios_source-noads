angular.module('starter').controller('PropertylistingHomeController',function($state,$ionicHistory,$ionicScrollDelegate,$ionicHistory,Location,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal,GoogleMaps){$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.collection=[];$scope.listing_settings=[];$scope.can_load_older_posts=!0;$scope.is_loading=!1;$scope.property_types=[];$scope.filterValues={};$scope.filterValues.minprice="";$scope.filterValues.maxprice="";$scope.filterCollection=[];$scope.is_filter_apply=!1;$scope.page_title='';var keyupTimer;$scope.searchObj={searchText:""};$scope.loadListings=function(){$scope.is_loading=!0;Loader.show();Propertylisting.findAll($scope.collection.length).success(function(data){$scope.page_title=data.page_title;$scope.can_load_older_posts=!!data.collection.length;$scope.collection=$scope.collection.concat(data.collection);$scope.property_types=data.property_types;Propertylisting.setPropertytype(JSON.stringify(data.property_types));$scope.unread_message_count=data.unread_message;$scope.is_loading=!1;$scope.listing_settings=Propertylisting.getListingSettings();Propertylisting.setPropertyFieldLabel(data.propertyfields);$scope.feildsSettings=Propertylisting.getPropertyFieldLabel();Loader.hide();$rootScope.$broadcast("refreshPageSize")}).error(function(error){Loader.hide();$scope.is_loading=!1;$scope.can_load_older_posts=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.loadMore=function(){if(!$scope.collection.length){return!1}
Propertylisting.findAll($scope.collection.length).success(function(data){$scope.page_title=data.page_title;$scope.can_load_older_posts=!!data.collection.length;$scope.collection=$scope.collection.concat(data.collection);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.can_load_older_posts=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.$on('$ionicView.beforeEnter',function(scopes,states){$scope.is_loading=!0;$scope.listing_settings=Propertylisting.getListingSettings();$scope.loadListings();$scope.feildsSettings=Propertylisting.getPropertyFieldLabel();var currentState=$ionicHistory.currentStateName();if(currentState=='propertylisting-home'){Propertylisting.setListingFilter({})}});$scope.lisingFeaturesImages=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/propertylisting/assets/media/no_image.jpg"}};$scope.seachListingModal=function(){return!0};$scope.forTranslate=function(text){return $translate.instant(text,"propertylisting")};$scope.customer_avatar=function(image,isApp){if(isApp){return IMAGE_URL+image}
if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/propertylisting/assets/media/customer-placeholder.png"}};$scope.convertDate=function(date){return $filter("moment_calendar")(date*1000)};$scope.listingDeails=function(property_listing_id){$scope.isLoading=!0;Loader.show();$scope.listing_deails=[];$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/modal/detail.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$ionicSlideBoxDelegate.update();Propertylisting.findByListingId(property_listing_id).success(function(data){$timeout(function(){var listing_setting=Propertylisting.getListingSettings();$scope.feildsSettings=Propertylisting.getPropertyFieldLabel();$scope.area_unit=listing_setting.area_unit;$scope.listing_deails=data.collection;$scope.listing_deails.enable_favorite=$scope.listing_settings.enable_favorite;$scope.listing_deails.enable_owner_info=$scope.listing_settings.enable_owner_info;$scope.currentCustomerId=Customer.id;$scope.isLoading=!1;Loader.hide()},300)}).error(function(error){Loader.hide();$scope.isLoading=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")});$scope.detailsModal=modal;$scope.detailsModal.show()})};$scope.closeModalDetails=function(){$scope.detailsModal.remove()}
$scope.amenitiesImages=function(amenities){if(amenities.is_custom==0){return IMAGE_URL+'app/local/modules/Propertylisting/resources/design/desktop/flat/'+amenities.icon}else{return IMAGE_URL+'/images/application'+amenities.icon}};$scope.markAsFavorite=function(property_listing_id){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
Propertylisting.markAsFavorite(property_listing_id).success(function(data){$scope.listing_deails.is_favorite=data.is_favorite}).error(function(error){Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.shareFeedbackScreen=function(){$scope.feedbackFrom={feedbackChoice:''};$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/modal/feedback.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.FeedbackModal=modal;$scope.FeedbackModal.show()})};$scope.closeFeedbackModal=function(){$scope.FeedbackModal.remove()}
$scope.actionButtonbottom=function(property_listing_id){$scope.listing_settings=Propertylisting.getListingSettings();var buttonIndexing=[];var buttonPositon=0;var sheetButtons=[];if($scope.listing_settings.enable_favorite){var textFavorite=$scope.listing_deails.is_favorite?'Unmark as favorite':'Mark as favorite';sheetButtons[buttonPositon]={text:$translate.instant(textFavorite,'propertylisting')};buttonIndexing[buttonPositon]='favorite';buttonPositon=buttonPositon+1}
if($scope.listing_settings.enable_message){sheetButtons[buttonPositon]={text:$translate.instant('Message','propertylisting')};buttonIndexing[buttonPositon]='message';buttonPositon=buttonPositon+1}
if($scope.listing_settings.enable_share_feedback){sheetButtons[buttonPositon]={text:$translate.instant('Share Feedback/Reports','propertylisting')};buttonIndexing[buttonPositon]='feedback'}
var hideSheet=$ionicActionSheet.show({buttons:sheetButtons,cancelText:$translate.instant('Cancel','propertylisting'),cancel:function(){hideSheet()},buttonClicked:function(index){if(buttonIndexing[index]=="message"){$scope.listingMessage()}
if(buttonIndexing[index]=="feedback"){$scope.shareFeedbackScreen()}
if(buttonIndexing[index]=="favorite"){$scope.markAsFavorite(property_listing_id)}
return!0}})}
$scope.sendFeedback=function(feedbackFrom){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
if(feedbackFrom.feedbackChoice==''){Dialog.alert($translate.instant("Validation Error","propertylisting"),$translate.instant("Please select atleast one options!","propertylisting"),"OK",-1,"propertylisting")}else{feedbackFrom.listingId=$scope.listing_deails.id;Propertylisting.saveFeedback(feedbackFrom).success(function(data){Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Thank you for your feedback!",'propertylisting'),"OK",-1,"propertylisting");$scope.closeFeedbackModal()}).error(function(error){Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}}
$scope.listingMessage=function(listingParams=[]){Loader.show();$scope.messages=[];$scope.sentmessages=[];var listing_listing_id=0;$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/modal/message.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.messageUserId=Customer.id;if(listingParams.id){$scope.sentmessages.listing_id=listingParams.property_listing_id;$scope.sentmessages.receiver_id=listingParams.user_id;$scope.sentmessages.sender_id=listingParams.sender_id;$scope.sentmessages.added_platform=listingParams.added_platform;$scope.messages_page_title=listingParams.headline;listing_listing_id=listingParams.property_listing_id}else{$scope.sentmessages.listing_id=$scope.listing_deails.id;$scope.sentmessages.receiver_id=$scope.listing_deails.user_id;$scope.sentmessages.added_platform=$scope.listing_deails.added_platform;$scope.messages_page_title=$scope.listing_deails.headline;listing_listing_id=$scope.listing_deails.id}
Propertylisting.findMessageByListingId(listing_listing_id).success(function(data){$scope.messages=data.messages;$scope._scrollBottom();Loader.hide()}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")});$scope.messagesModal=modal;$scope.messagesModal.show()})};$scope.closeMessagesModal=function(){$scope.messagesModal.remove()}
$scope.sendMessage=function(sentmessages){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
if(sentmessages.message==''){Dialog.alert("Validation Error","Please enter a messages!","OK",-1,"propertylisting")}else{$scope.sending_message=!0;Propertylisting.saveMessage(sentmessages).success(function(data){$scope.messages=data.messages;$scope._scrollBottom();$scope.sentmessages.message='';$scope.sending_message=!1}).error(function(error){Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting");$scope.sending_message=!1})}}
$scope.convertMessageDate=function(date){return $filter("moment_calendar")((new Date(date)).getTime())};$scope._scrollBottom=function(){$timeout(function(){$ionicScrollDelegate.$getByHandle('messageScroll').scrollBottom(!0)},500)};$scope.searchListingModal=function(){Loader.show();$scope.search_page_title=$translate.instant("Search Listing",'propertylisting');$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/modal/search.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.searchObj.searchText="";$timeout(function(){document.getElementById("contactSearch").focus()},300);Loader.hide();$scope.searchModal=modal;$scope.searchModal.show()})};$scope.closeSearchModal=function(){$scope.searchModal.remove()}
$scope.searchListing=function(){$scope.Searchcollection=[];$scope.is_loading=!0;$scope.searchObj.searchText=document.getElementById("contactSearch").value;if($scope.searchObj.searchText.length<2){clearTimeout(keyupTimer);return}
keyupTimer=setTimeout(function(){$scope.Searchcollection=[];Propertylisting.findAllSearch($scope.Searchcollection.length,$scope.searchObj.searchText).success(function(data){$scope.can_load_search_older_posts=!!data.collection.length;$scope.Searchcollection=data.collection;console.log("Searchcollection",$scope.Searchcollection);$timeout(function(){$scope.is_loading=!1},600);$scope.listing_settings=Propertylisting.getListingSettings();$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.is_loading=!1;$scope.can_load_search_older_posts=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})},1000)};$scope.loadSearchMore=function(){if(!$scope.Searchcollection.length){return!1}
Propertylisting.findAllSearch($scope.Searchcollection.length,$scope.searchObj.searchText).success(function(data){$scope.can_load_search_older_posts=!!data.collection.length;$scope.Searchcollection=$scope.Searchcollection.concat(data.collection);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.is_loading=!1;$scope.can_load_search_older_posts=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.isUndefined=function(thing){return(typeof thing==="undefined")}
$scope.filterValuesChecked=function(data){if(!$scope.isUndefined(data)){var isObjectEmpty=!Object.keys(data).length;if(isObjectEmpty){return!1}else{return!0}}else{return!1}}
$scope.filterMenuModal=function(){Loader.show();$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/modal/filter_menu.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.FilterModal=modal;$scope.FilterModal.show();$timeout(function(){$scope.f_list=$scope.f_list;$scope.propertytypes=$scope.property_types;$scope.filterValues=Propertylisting.getListingFilter();var isObjectEmpty=!Object.keys($scope.filterValues).length;if(isObjectEmpty){$scope.filterValues.propertyFor=''}
console.log('filterValues',$scope.filterValues);Loader.hide()},600)})};$scope.closeFilterModal=function(){$scope.FilterModal.remove()}
$scope.toggleList=function(data){if($scope.f_list==data){$scope.f_list=-1}else{$scope.f_list=data}}
$scope.applyListingFilter=function(data){var isObjectEmpty=!Object.keys($scope.filterValues).length;if(isObjectEmpty){Dialog.alert($translate.instant("Error","propertylisting"),$translate.instant("Please select atleast 1 option for filter listing.","propertylisting"),"OK",-1,"propertylisting");return!1}
if($scope.filterValues.minprice!=''&&$scope.filterValues.maxprice!=''&&$scope.filterValues.minprice>$scope.filterValues.maxprice){Dialog.alert($translate.instant("Error","propertylisting"),$translate.instant("Min Price can not be greater than Max Price.","propertylisting"),"OK",-1,"propertylisting");return!1}
$scope.is_filter_apply=!0;$scope.closeFilterModal();Propertylisting.setListingFilter($scope.filterValues);var currentState=$ionicHistory.currentStateName();$state.go("propertylisting-filter",{value_id:$scope.value_id,filter:'filter'},{reload:!0})}
$scope.clearAllFilter=function(){$scope.is_filter_apply=!0;$scope.closeFilterModal();Propertylisting.setListingFilter({});$state.go("propertylisting-home",{value_id:$scope.value_id},{reload:!0})}
$scope.range=function(min,max,step){step=step||1;var input=[];for(var i=min;i<=max;i+=step)input.push(i);return input}}).controller('PropertylistingFilterController',function($controller,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingHomeController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.collectionFilter=[];$scope.listing_settings=[];$scope.can_load_older_posts=!0;$scope.is_loading=!1;$scope.filterValues=Propertylisting.getListingFilter();$scope.loadFilterContent=function(){$scope.is_loading=!0;Loader.show();Propertylisting.listingFilter($scope.collectionFilter.length,$scope.filterValues).success(function(data){$scope.can_load_older_posts=!!data.collection.length;$scope.collectionFilter=$scope.collectionFilter.concat(data.collection);$scope.is_loading=!1;$scope.listing_settings=Propertylisting.getListingSettings();Loader.hide();$rootScope.$broadcast("refreshPageSize")}).error(function(error){Loader.hide();$scope.is_loading=!1;$scope.can_load_older_posts=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}
$scope.loadFilterContent();$scope.loadFilterMore=function(){if(!$scope.collectionFilter.length){return!1}
Propertylisting.listingFilter($scope.collectionFilter.length,$scope.filterValues).success(function(data){$scope.can_load_older_posts=!!data.collection.length;$scope.collectionFilter=$scope.collectionFilter.concat(data.collection);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.can_load_older_posts=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}}).controller('PropertylistingFavoriteController',function($controller,Application,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingHomeController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.favoritecollection=[];$scope.viewcollection=[];$scope.is_loading=!1;$scope.listing_settings=Propertylisting.getListingSettings();$scope.$on('$ionicView.enter',function(scopes,states){$scope.is_favorites=1;$scope.is_view=0;$scope.is_inbox=0});$scope.loadFavoriteContent=function(){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
$scope.is_loading=!0;Loader.show();Propertylisting.listingFavorite().success(function(data){$scope.listingFavoriteData=data;$scope.favoritecollection=data.collection;$scope.viewcollection=data.viewcollection;$scope.messagescollection=data.messages;if($scope.is_view){$scope.collectionList=$scope.viewcollection}
if($scope.is_inbox){$scope.collectionList=$scope.messagescollection}
if($scope.is_favorites){$scope.collectionList=$scope.favoritecollection}
$scope.is_loading=!1;Loader.hide()}).error(function(error){$scope.is_loading=!1;Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){})}
$scope.loadFavoriteContent();$scope.tabContent=function(tab){if(tab==1){$scope.is_favorites=1;$scope.is_view=0;$scope.is_inbox=0;$scope.collectionList=$scope.favoritecollection}
if(tab==2){$scope.is_favorites=0;$scope.is_view=1;$scope.is_inbox=0;$scope.collectionList=$scope.viewcollection}
if(tab==3){$scope.is_favorites=0;$scope.is_view=0;$scope.is_inbox=1;$scope.collectionList=$scope.messagescollection}}
$scope.$on('modal.removed',function(){$scope.loadFavoriteContent();if(!Customer.isLoggedIn()){$state.go("propertylisting-home",{value_id:$scope.value_id},{reload:!0})}});$scope.messageCustomerName=function(value){if(value.sender_customer_id==Customer.id){if(value.receiver_customer_id!=''&&value.receiver_customer_id!=null){return value.receiver_first_name+' '+value.receiver_last_name}else{return $scope.listingFavoriteData.app_name}}else{return value.sender_first_name+' '+value.sender_last_name}}
$scope.messageCustomerImage=function(value){if(value.sender_customer_id==Customer.id){if(value.receiver_customer_id!=''&&value.receiver_customer_id!=null){if(value.receiver_image!=''&&value.receiver_image!=null&&value.receiver_image!="null"){return IMAGE_URL+'images/customer'+value.receiver_image}else{return"./features/propertylisting/assets/media/customer-placeholder.png"}}else{return IMAGE_URL+$scope.listingFavoriteData.app_image}}else{if(value.sender_image!=''&&value.sender_image!=null&&value.sender_image!="null"){return IMAGE_URL+'images/customer'+value.sender_image}else{return"./features/propertylisting/assets/media/customer-placeholder.png"}}}}).controller('PropertylistingListController',function($controller,Application,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingHomeController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.user_id=Customer.id;$scope.collectionBy_user=[];$scope.search_txt="";$scope.islogin=!1;$scope.$on('$ionicView.beforeEnter',function(scopes,states){if(Customer.isLoggedIn()){$scope.loadListingById();$scope.is_loading=!0;$scope.islogin=!0}else{$scope.islogin=!1}});$scope.checkLogin=function(){Customer.loginModal($scope,function(){$state.go("propertylisting-list",{value_id:$scope.value_id},{reload:!0})},function(){},function(){$state.go("propertylisting-list",{value_id:$scope.value_id},{reload:!0})})}
$scope.loadListingById=function(){$scope.is_loading=!0;Loader.show();Propertylisting.findAllByUserId($scope.collectionBy_user.length).success(function(data){$scope.page_title=data.page_title;$scope.can_load_older_posts_list=!!data.collection.length;$scope.collectionBy_user=$scope.collectionBy_user.concat(data.collection);$scope.property_types=data.property_types;$scope.unread_message_count=data.unread_message;$scope.listing_settings=Propertylisting.getListingSettings();$rootScope.$broadcast("refreshPageSize");$timeout(function(){$scope.isLoading=!1;Loader.hide()},300)}).error(function(error){Loader.hide();$scope.is_loading=!1;$scope.can_load_older_posts_list=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.loadMorelisting=function(){if(!$scope.collectionBy_user.length){return!1}
Propertylisting.findAllByUserId($scope.collectionBy_user.length,$scope.user_id).success(function(data){$scope.page_title=data.page_title;$scope.can_load_older_posts_list=!!data.collection.length;$scope.collectionBy_user=$scope.collectionBy_user.concat(data.collection);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.can_load_older_posts_list=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}}).controller('PropertylistingMapController',function($controller,$state,$ionicScrollDelegate,Location,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal,GoogleMaps){angular.extend(this,$controller('PropertylistingHomeController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.filter=Propertylisting.filter
$scope.collection=[];$scope.listing_settings=[];$scope.can_load_older_posts=!0;$scope.is_loading=!1;$scope.property_types=[];$scope.filterValues={};$scope.filterValues.minprice="";$scope.filterValues.maxprice="";$scope.filterCollection=[];$scope.is_filter_apply=!1;$scope.page_title='';$scope.map=null;var keyupTimer;$scope.searchObj={searchText:""};$scope.markers=[];$scope.filters={latitude:0,longitude:0,};$scope.filterValues=Propertylisting.getListingFilter();$scope.loadMaps=function(){Location.getLocation({timeout:10000},!0).then(function(position){$scope.filters.latitude=position.coords.latitude;$scope.filters.longitude=position.coords.longitude},function(){$scope.filters.latitude=0;$scope.filters.longitude=0}).then(function(){$scope.mapConfig={cluster:!0,markers:$scope.markers,bounds_to_marker:!0,};$timeout(function(){$scope.centerMap();GoogleMaps.setPanelId("panel")},300);$scope.findAllByMapListing($scope.filters.latitude,$scope.filters.longitude)})};$scope.centerMap=function(){$scope.gps_loading=!0;GoogleMaps.setCenter().then(function(){$scope.map=GoogleMaps.map;$scope.map.setZoom(12);$scope.map.setMapTypeId(google.maps.MapTypeId.ROADMAP)},function(){Dialog.alert($translate.instant("Error"),$translate.instant("Could not find your current location"));console.error.apply(console,arguments)}).finally(function(){$scope.gps_loading=!1})};$scope.findAllByMapListing=function(latitude,longitude){$scope.is_loading=!0;Loader.show();Propertylisting.findAllByMap(latitude,longitude,$scope.filterValues).success(function(data){$scope.page_title=data.page_title;$scope.collection=data.collection;$scope.property_types=data.property_types;Propertylisting.setPropertytype(JSON.stringify(data.property_types));$scope.unread_message_count=data.unread_message;$scope.is_loading=!1;$scope.listing_settings=Propertylisting.getListingSettings();$scope.setMarkers($scope.collection);Loader.hide();$rootScope.$broadcast("refreshPageSize")}).error(function(error){Loader.hide();$scope.is_loading=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})}
$scope.$on('$ionicView.beforeEnter',function(scopes,states){$scope.is_loading=!0;$scope.loadMaps()});$scope.setMarkers=function(collections){_.forEach(collections,function(ad){if(ad.address_lat){$scope.markers.push(GoogleMaps.addMarker(_.merge({title:ad.headline,onClick:(function(marker){$timeout(function(){$scope.listingDeails(ad.id)})})},{latitude:ad.address_lat,longitude:ad.address_lng,})))}})}});angular.module('starter').controller('PropertylistingAddBasicinfoController',function($state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.listing_settings=Propertylisting.getListingSettings();$scope.feildsSettings=Propertylisting.getPropertyFieldLabel();$scope.addpropertyValues={property_image:[],propertyFor:'',propertyTypes:'',bedrooms:'',bathrooms:'',tenure:'',furnishing:''};$scope.property_types_add=[];$scope.property_types_add=JSON.parse(Propertylisting.getPropertytype());$scope.curentyear=new Date().getFullYear();$scope.loadAmenities=function(){Propertylisting.fetchAmenities().success(function(data){$scope.listingAmenitiesData=data.listing_Amenities}).error(function(error){}).finally(function(){})}
$scope.loadAmenities();if(Propertylisting.getaddpropertyValue()){$scope.addpropertyValues=JSON.parse(Propertylisting.getaddpropertyValue())}
$scope.range=function(min,max,step){step=step||1;var input=[];for(var i=min;i<=max;i+=step)input.push(i);return input};$scope.forTranslate=function(text){return $translate.instant(text,"propertylisting")};$scope.addBasicinfo=function(){Propertylisting.setaddpropertyValue(JSON.stringify($scope.addpropertyValues));var data1=JSON.parse(Propertylisting.getaddpropertyValue());$state.go("propertylisting-add-locations",{value_id:$scope.value_id},{reload:!0})}
$scope.$on('$ionicView.beforeEnter',function(scopes,states){$scope.feildsSettings=Propertylisting.getPropertyFieldLabel()})}).controller('PropertylistingAddLocationsController',function($controller,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingAddBasicinfoController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.addLocations=function(){var data=angular.merge($scope.addpropertyValues,JSON.parse(Propertylisting.getaddpropertyValue()));Propertylisting.setaddpropertyValue(JSON.stringify(data));console.log('addpropertyValues',$scope.addpropertyValues);$state.go("propertylisting-add-price",{value_id:$scope.value_id},{reload:!0})}
$scope.disableTap=function(){var container=angular.element(document.getElementsByClassName('pac-container'));container.attr('data-tap-disabled','true');container.on("click",function(){document.getElementById('pac-input').blur()})};$scope.updateAddress=function(){$scope.addpropertyValues.address_lat=$scope.addpropertyValues.address_lng=null;$scope.addpropertyValues.zipcode=null;if(_.isObject($scope.addpropertyValues.place)){var loc=_.get($scope.addpropertyValues,"place.geometry.location");if(loc){$scope.addpropertyValues.address_lat=loc.lat();$scope.addpropertyValues.address_lng=loc.lng();_.forEach(_.get($scope.addpropertyValues.place,"address_components"),function(adco){if(_.includes(_.get(adco,"types")||[],"postal_code")){$scope.addpropertyValues.zipcode=_.get(adco,"long_name")}
if(_.includes(_.get(adco,"types")||[],"country")){$scope.addpropertyValues.country=_.get(adco,"short_name")}})}}}}).controller('PropertylistingAddpriceController',function($controller,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingAddLocationsController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.addprice=function(){var data=angular.merge($scope.addpropertyValues,JSON.parse(Propertylisting.getaddpropertyValue()));Propertylisting.setaddpropertyValue(JSON.stringify(data));$state.go("propertylisting-add-amenities",{value_id:$scope.value_id},{reload:!0})}}).controller('PropertylistingAddamenitiesController',function($controller,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingAddpriceController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.addamenities=function(){var data=angular.merge($scope.addpropertyValues,JSON.parse(Propertylisting.getaddpropertyValue()));Propertylisting.setaddpropertyValue(JSON.stringify(data));$state.go("propertylisting-add-images",{value_id:$scope.value_id},{reload:!0})}}).controller('PropertylistingAddImagesController',function($controller,$state,$cordovaCamera,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal,Application,$ionicPopup){angular.extend(this,$controller('PropertylistingAddamenitiesController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.listing_settings=Propertylisting.getListingSettings();$scope.addPicture=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant("Cancel","propertylisting"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant("OK","propertylisting"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){if($scope.addpropertyValues.property_image.includes(image_url)===!1){$scope.addpropertyValues.property_image.push(image_url)}else{Dialog.alert($translate.instant("Error","propertylisting"),$translate.instant("This image is already added!",'propertylisting'),"OK",-1,"propertylisting")}}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture","propertylisting")},{text:$translate.instant("Import from Library","propertylisting")}],cancelText:$translate.instant("Cancel","propertylisting"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.removeImage=function(item){var index=$scope.addpropertyValues.property_image.indexOf(item);$scope.addpropertyValues.property_image.splice(index,1)}
$scope.addImages=function(){var data=angular.merge($scope.addpropertyValues,JSON.parse(Propertylisting.getaddpropertyValue()));Propertylisting.setaddpropertyValue(JSON.stringify(data));$state.go("propertylisting-add-owner-info",{value_id:$scope.value_id},{reload:!0})}}).controller('PropertylistingAddOwnerInfoController',function($ionicHistory,$controller,$state,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal){angular.extend(this,$controller('PropertylistingAddImagesController',{$ionicModal:$ionicModal,Dialog:Dialog,$rootScope:$rootScope,$scope:$scope,$stateParams:$stateParams,Propertylisting:Propertylisting}));$scope.addOwnerinfo=function(){Loader.show();var data=angular.merge($scope.addpropertyValues,JSON.parse(Propertylisting.getaddpropertyValue()));Propertylisting.setaddpropertyValue(JSON.stringify(data));Propertylisting.savePropertyinfo(data).success(function(data){Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Property added successfully!",'propertylisting'),"OK",-1,"propertylisting");Propertylisting.setaddpropertyValue(JSON.stringify({property_image:[]}));$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});$state.go('home').then(function(){$state.go("propertylisting-home",{value_id:$scope.value_id},{reload:!0}).then(function(){$state.go("propertylisting-list",{value_id:$scope.value_id},{reload:!0})})});Loader.hide()}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}});angular.module('starter').controller('PropertylistingEditController',function($state,GoogleMaps,$cordovaCamera,$ionicScrollDelegate,$ionicActionSheet,$timeout,$ionicSlideBoxDelegate,$stateParams,$scope,$rootScope,$translate,Propertylisting,Customer,Loader,Dialog,$filter,$ionicModal,$ionicPopup,Application){$scope.value_id=Propertylisting.value_id=$stateParams.value_id;$scope.property_id=Propertylisting.property_id=$stateParams.property_id;$scope.property_types_edit=[];$scope.amenitiesId="";$scope.property_types_edit=JSON.parse(Propertylisting.getPropertytype());$scope.curentyear=new Date().getFullYear();$scope.feildsSettings=Propertylisting.getPropertyFieldLabel();$scope.location={};$scope.convertDate=function(date){return $filter("moment_calendar")(date*1000)};$scope.amenitiesImages=function(amenities){if(amenities.is_custom==0){return IMAGE_URL+'app/local/modules/Propertylisting/resources/design/desktop/flat/'+amenities.icon}else{return IMAGE_URL+'/images/application'+amenities.icon}};$scope.lisingFeaturesImages=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}else{return"./features/propertylisting/assets/media/no_image.jpg"}};$scope.$on('$ionicView.beforeEnter',function(scopes,states){$scope.is_loading=!0;$scope.loadpropertyData();$scope.feildsSettings=Propertylisting.getPropertyFieldLabel()});$scope.forTranslate=function(text){return $translate.instant(text,"propertylisting")};$scope.loadpropertyData=function(){$scope.amenities_ids=[];Loader.show();$scope.isLoading=!0;Propertylisting.findByListingIdEdit($scope.property_id).success(function(data){$timeout(function(){$scope.listing_deails=data.collection;$scope.propertystatus=$scope.listing_deails.status;$scope.edit_listing_value=data.collection;$scope.isLoading=!0;Loader.hide();$scope.listing_settings=Propertylisting.getListingSettings();angular.forEach($scope.listing_deails.amenities,function(value,key){$scope.amenities_ids.push(parseInt(value.id))})},300)}).error(function(error){$scope.isLoading=!1;Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})};$scope.checkAmenities=function(id){if($scope.amenities_ids.includes(id)){return!0}else{return!1}}
$scope.saveAmenities=function(amenitiesId){Loader.show();Propertylisting.saveAmenities(amenitiesId,$scope.property_id).success(function(data){Loader.hide()}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.$on('$ionicView.enter',function(scopes,states){Loader.show();$scope.isLoading=!0;Propertylisting.fetchAmenities().success(function(data){$scope.listingAmenitiesData=data.listing_Amenities;Loader.hide();$scope.isLoading=!1}).error(function(error){Loader.hide();$scope.isLoading=!1;Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")}).finally(function(){})});$scope.deleteImage=function(id){var image_id=id;var confirmPopup=$ionicPopup.confirm({title:$translate.instant("Confirmation!","propertylisting"),template:$translate.instant("Are you sure you want to delete this image?","propertylisting")});confirmPopup.then(function(res){if(res){Propertylisting.deleteImage(image_id).success(function(data){$timeout(function(){if(data.success==!0){Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Image deleted successfully!",'propertylisting'),"OK",-1,"propertylisting");$scope.loadpropertyData()}},300)}).error(function(error){Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}else{Dialog.alert($translate.instant("Error","propertylisting"),error.message,$translate.instant("OK","propertylisting"),-1,"propertylisting")}})};$scope.range=function(min,max,step){step=step||1;var input=[];for(var i=min;i<=max;i+=step)input.push(i);return input};$scope.changeStatus=function(id,status){var property_status=status;var property_id=id;Loader.show();$scope.isLoading=!0;Propertylisting.changeStatusEdit(property_status,property_id).success(function(data){if(data.success==!0){Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Status updated!",'propertylisting'),"OK",-1,"propertylisting");$scope.loadpropertyData()}}).error(function(error){$scope.isLoading=!1;Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})};$scope.openEditbasicinfoModal=function(){$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/propertyListingEdit/basicinfoedit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){console.log('edit_listing_value',$scope.edit_listing_value);$scope.EditBasicInfoModal=modal;$scope.EditBasicInfoModal.show()})};$scope.checkBedroom=function(data){if($scope.edit_listing_value.bedrooms==data){console.log("t");return!0}else{console.log("f");return!1}};$scope.closeeditBasicInfoModal=function(){$scope.EditBasicInfoModal.remove();$state.go("propertylisting-edit",{value_id:$scope.value_id},{reload:!0})}
$scope.openEditlocationModal=function(){$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/propertyListingEdit/locationedit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.EditlocationModal=modal;$scope.EditlocationModal.show()})};$scope.closeeditlocationModal=function(){$scope.EditlocationModal.remove();$state.go("propertylisting-edit",{value_id:$scope.value_id},{reload:!0})}
$scope.openEditPriceModal=function(){$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/propertyListingEdit/priceedit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.EditPriceModal=modal;$scope.EditPriceModal.show()})};$scope.closeeditPriceModal=function(){$scope.EditPriceModal.remove();$state.go("propertylisting-edit",{value_id:$scope.value_id},{reload:!0})}
$scope.openEditOwnerinfoModal=function(){$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/propertyListingEdit/ownerinfoedit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){if($scope.edit_listing_value&&!$scope.isUndefined($scope.edit_listing_value.availability)){$scope.edit_listing_value.availability=new Date($scope.edit_listing_value.availability)}
$scope.EditOwnerinfoModal=modal;$scope.EditOwnerinfoModal.show()})};$scope.isUndefined=function(thing){return(typeof thing==="undefined")}
$scope.closeeditOwnerinfoModal=function(){$scope.EditOwnerinfoModal.remove();$state.go("propertylisting-edit",{value_id:$scope.value_id},{reload:!0})}
$scope.openAddImageModal=function(){$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/propertyListingEdit/imageedit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.property_image="";$scope.AddImageModal=modal;$scope.AddImageModal.show()})};$scope.closeAddImageModal=function(){$scope.AddImageModal.remove()}
$scope.openEditAmenitiesModal=function(){$ionicModal.fromTemplateUrl('features/propertylisting/assets/templates/l1/propertyListingEdit/amenitiesedit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.property_image="";$scope.EditAmenitiesModal=modal;$scope.EditAmenitiesModal.show()})};$scope.closeEditAmenitiesModal=function(){$scope.EditAmenitiesModal.remove();$state.go("propertylisting-edit",{value_id:$scope.value_id},{reload:!0})}
$scope.editPropertyinfobasic=function(){Loader.show();Propertylisting.editPropertyinfo($scope.edit_listing_value).success(function(data){if(data.success==!0){Loader.hide();$scope.closeeditBasicInfoModal();Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Property edited successfully!",'propertylisting'),"OK",-1,"propertylisting")}}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.editPropertyLocation=function(){Loader.show();Propertylisting.editPropertyinfo($scope.edit_listing_value).success(function(data){if(data.success==!0){Loader.hide();$scope.closeeditlocationModal();Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Property edited successfully!",'propertylisting'),"OK",-1,"propertylisting")}}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.editPropertyPrice=function(){Loader.show();Propertylisting.editPropertyinfo($scope.edit_listing_value).success(function(data){if(data.success==!0){Loader.hide();$scope.closeeditPriceModal();Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Property edited successfully!",'propertylisting'),"OK",-1,"propertylisting")}}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.editPropertyownerinfo=function(){Loader.show();Propertylisting.editPropertyinfo($scope.edit_listing_value).success(function(data){if(data.success==!0){Loader.hide();$scope.closeeditOwnerinfoModal();Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Property edited successfully!",'propertylisting'),"OK",-1,"propertylisting")}}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.addPic=function(){var gotImage=function(image_url){$scope.imageToSend=image_url;$ionicPopup.show({template:'<center><img ng-src="{{imageToSend}}" style="max-width: 100%; max-height: 100%;"></center>',cssClass:'classifieds no-title',scope:$scope,buttons:[{text:$translate.instant("Cancel","propertylisting"),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant("OK","propertylisting"),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.property_image=image_url}}).finally(function(){$scope.imageToSend=null})};var gotError=function(err){};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(evt){gotImage(evt.target.result);input.off("change",selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on("change",selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant("Take a picture","propertylisting")},{text:$translate.instant("Import from Library","propertylisting")}],cancelText:$translate.instant("Cancel","propertylisting"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:800,targetHeight:800,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage("data:image/jpeg;base64,"+imageData)},gotError);return!0}})}};$scope.addImages=function(){Loader.show();Propertylisting.addImagesData($scope.property_image,$scope.property_id).success(function(data){$timeout(function(){if(data.success==!0){Loader.hide();$scope.closeAddImageModal();Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Image added successfully!",'propertylisting'),"OK",-1,"propertylisting");$state.go("propertylisting-edit",{value_id:$scope.value_id},{reload:!0})}},300)}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}
$scope.deleteListing=function(){var confirmPopup=$ionicPopup.confirm({title:$translate.instant("Confirmation!","propertylisting"),template:$translate.instant("Are you sure you want to delete this property?","propertylisting")});confirmPopup.then(function(res){if(res){Propertylisting.deleteListing($scope.property_id).success(function(data){$timeout(function(){if(data.success==!0){Dialog.alert($translate.instant("Success","propertylisting"),$translate.instant("Property deleted successfully!",'propertylisting'),"OK",-1,"propertylisting");$state.go("propertylisting-list",{value_id:$scope.value_id},{reload:!0})}},300)}).error(function(error){Dialog.alert($translate.instant("Error","propertylisting"),error.message,"OK",-1,"propertylisting")})}})};$scope.disableTap=function(){var container=angular.element(document.getElementsByClassName('pac-container'));container.attr('data-tap-disabled','true');container.on("click",function(){document.getElementById('pac-input').blur()})};$scope.updateAddress=function(){console.log('updateAddress',$scope.edit_listing_value);$scope.edit_listing_value.address_lat=$scope.edit_listing_value.address_lng=null;$scope.edit_listing_value.zipcode=null;if(_.isObject($scope.edit_listing_value.place)){var loc=_.get($scope.edit_listing_value,"place.geometry.location");if(loc){$scope.edit_listing_value.address_lat=loc.lat();$scope.edit_listing_value.address_lng=loc.lng();_.forEach(_.get($scope.edit_listing_value.place,"address_components"),function(adco){if(_.includes(_.get(adco,"types")||[],"postal_code")){$scope.edit_listing_value.zipcode=_.get(adco,"long_name")}
if(_.includes(_.get(adco,"types")||[],"country")){$scope.edit_listing_value.country=_.get(adco,"short_name")}})}}}});angular.module('starter').factory('Propertylisting',function($pwaRequest,Customer,$sbhttp,Url,Application,Pages){var factory={};factory.value_id=null;factory.settings=[];factory.filter={};factory.listings=[];factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.setListingSettings=function(settings){factory.settings=settings;return factory};factory.getListingSettings=function(){return factory.settings};factory.setaddpropertyValue=function(addproperty){factory.addproperty=addproperty;return factory};factory.getaddpropertyValue=function(){return factory.addproperty};factory.setListingFilter=function(filter){factory.filter=filter;return factory};factory.getListingFilter=function(){return factory.filter};factory.setListings=function(listings){factory.listings=listings;return factory};factory.getListings=function(){return factory.listings};factory.setPropertytype=function(type){factory.type=type;return factory};factory.getPropertytype=function(){return factory.type};factory.setPropertyFieldLabel=function(label){factory.label=label;return factory};factory.getPropertyFieldLabel=function(){return factory.label};factory.onStart=function(){Application.loaded.then(function(){var propertylisting=_.find(Pages.getActivePages(),{code:'propertylisting'});if(!propertylisting){return}
factory.setValueId(propertylisting.value_id).fetchListingSettings().then(function(data){factory.setListingSettings(data.data.listing_settings);factory.setPropertyFieldLabel(data.data.propertyfields)})})}
factory.fetchListingSettings=function(offset){var params={value_id:this.getValueId()};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/fetch-listing-settings',params),cache:!1,responseType:'json'})};factory.fetchFieldLabel=function(){var params={value_id:this.getValueId()};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/fetch-field-label',params),cache:!1,responseType:'json'})};factory.findAll=function(offset){var params={value_id:this.value_id,offset:offset};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/findAll',params),cache:!1,responseType:'json'})};factory.findAllByMap=function(latitude,longitude,filterValues){return $pwaRequest.post('propertylisting/mobile_view/findall-by-map',{data:{filterValues:filterValues,value_id:this.value_id,latitude:latitude,longitude:longitude},refresh:!0})};factory.findByListingId=function(listingId){var params={value_id:this.value_id,listing_id:listingId};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/find-by-listing-id',params),cache:!1,responseType:'json'})};factory.markAsFavorite=function(listingId){var params={value_id:this.value_id,listing_id:listingId};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/mark-as-favorite',params),cache:!1,responseType:'json'})};factory.listingFavorite=function(){var params={value_id:this.value_id};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/load-customer-favorite',params),cache:!1,responseType:'json'})};factory.saveFeedback=function(data){return $pwaRequest.post('propertylisting/mobile_view/save-feedback',{data:{report:data.feedbackChoice,message:data.reportMessages,value_id:this.value_id,listing_id:data.listingId},refresh:!0})};factory.findAllSearch=function(offset,search_text){return $pwaRequest.post('propertylisting/mobile_view/search-listing',{data:{offset:offset,search_text:search_text,value_id:this.value_id,},refresh:!0})};factory.saveMessage=function(data){return $pwaRequest.post('propertylisting/mobile_view/save-message',{data:{message:data.message,value_id:this.value_id,listing_id:data.listing_id,receiver_id:data.receiver_id,sender_id:data.sender_id,added_platform:data.added_platform},refresh:!0})};factory.listingFilter=function(offset,filterValues){return $pwaRequest.post('propertylisting/mobile_view/listing-filter',{data:{filterValues:filterValues,value_id:this.value_id,offset:offset},refresh:!0})};factory.findMessageByListingId=function(listingId){var params={value_id:this.value_id,listing_id:listingId};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/find-messages-by-listing-id',params),cache:!1,responseType:'json'})};factory.fetchAmenities=function(){var params={value_id:this.value_id};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/fetch-amenities',params),cache:!1,responseType:'json'})};factory.savePropertyinfo=function(data){return $pwaRequest.post('propertylisting/mobile_view/save-property',{data:{propertyData:data,value_id:this.value_id},refresh:!0})};factory.deleteImage=function(id){var params={image_id:id};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/delete-image',params),cache:!1,responseType:'json'})};factory.editPropertyinfo=function(data){return $pwaRequest.post('propertylisting/mobile_view/edit-property',{data:{editedPropertyData:data,value_id:this.value_id},refresh:!0})};factory.findAllByUserId=function(offset){var params={value_id:this.value_id,offset:offset};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/findAll-by-user-id',params),cache:!1,responseType:'json'})};factory.findByListingIdEdit=function(listingId){var params={value_id:this.value_id,listing_id:listingId};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/find-by-listing-id-edit',params),cache:!1,responseType:'json'})};factory.changeStatusEdit=function(status,id){var params={value_id:this.value_id,property_status:status,property_id:id};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/change-status-edit',params),cache:!1,responseType:'json'})};factory.addImagesData=function(data,id){return $pwaRequest.post('propertylisting/mobile_view/add-images-data',{data:{property_image:data,value_id:this.value_id,property_id:id},refresh:!0})};factory.saveAmenities=function(amenities_id,listing_id){var params={value_id:this.value_id,amenities_id:amenities_id,listing_id:listing_id};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/save-amenities',params),cache:!1,responseType:'json'})};factory.deleteListing=function(id){var params={listing_id:id};return $sbhttp({method:'GET',url:Url.get('propertylisting/mobile_view/delete-property',params),cache:!1,responseType:'json'})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.listing .propertylisting_row_margin{margin:-4%}.listing .listing-body{padding-top:0;border-top:0}.listing .listing-price{text-align:right;font-size:14px;font-weight:700;vertical-align:middle}.listing .listing-post-time{font-size:11px;padding-left:5%;opacity:.7}.listing .listing-plotsize{vertical-align:middle}.listing .bottom-action-button{z-index:9999}.listing .listing-other-info{font-size:12px}.listing .listing-other-info .col{padding:5px 0}.listing .property-listing-image-overlay-content{margin-top:-36px;text-align:center;background-color:rgba(0,0,0,.5);position:relative;color:#fff;font-size:12px}.listing .property-listing-image-overlay-content .col{padding:5px 0}.listing .property-listing-image-overlay-content .row{padding:0}.listing .listing-type{text-align:right;text-transform:uppercase;font-weight:700;opacity:.7}.listing .listing-header{border-bottom:0}.listing .owner-info-item{border:0}.listing .listing-location{opacity:.7}.listing .listing-details-listing-for{margin-top:5%}.listing .listing-size-info{font-size:12px;text-align:center}.listing .listing-size-info .col{padding:5px 0}.listing .listing-feature-img{height:150px;object-fit:cover}.listing .propertylisting-row-values{padding:5px 16px;text-align:right}.listing .propertylisting-row-values .item-note{float:left;font-size:16px;font-size:14px;text-transform:uppercase}.listing .listing-basic-info .listing-type{text-align:left;text-transform:uppercase;font-weight:500;opacity:.6;font-size:11px}.listing .listing-basic-info h2.listing-headline-name{white-space:normal}.listing .item.listing-info{padding-top:0}.listing .item.item-amenities{min-height:auto}.listing .item.item-amenities.item-avatar>img:first-child{top:10px}.listing h2.amenities-name{opacity:.7}.listing .listing-details-favorite{position:absolute;top:24px;left:28px;z-index:1;font-size:24px}.listing .listing-bedroom{text-align:center}.listing .listing-bathroom{text-align:center}.listing .propertylisting-filter-row-menu .checkbox{padding:7px 0}.listing .propertylisting-filter-row-menu .checkbox input{width:20px;height:20px}.listing .propertylisting-filter-row-menu .item-checkbox{padding-left:40px}.listing .propertylisting-filter-row-menu .checkbox-icon{width:20px;height:20px}.listing .listing-filter-item{display:list-item}.listing ion-list.listing-filter-list .list{white-space:nowrap;overflow-y:hidden;overflow-x:scroll;-webkit-overflow-scrolling:touch}.listing .listing-filter-divider{margin-top:20px}.listing ion-content#listing-filter-content{margin-top:24px}.listing .budget-row .item{border:0px!important}.listing .button-floating-action{position:fixed!important;top:calc(90vh - 50px)!important;right:2vw!important;border-radius:100px!important;border-width:0!important;padding:5px 12px 5px 12px!important;z-index:999!important;box-shadow:5px 5px 5px #888!important}.listing #google-maps{position:unset!important}.listing .button-gps-loading{position:fixed!important;top:calc(90vh - 50px)!important;left:2vw!important;border-radius:100px!important;border-width:0!important;padding:5px 12px 5px 12px!important;z-index:999!important;box-shadow:5px 5px 5px #888!important}span.badge-message{top:17px!important;right:-4px!important;position:absolute!important;padding:0 4px 0 3px;line-height:13px;height:14px;font-size:10px}.bar .listing-footer{padding-top:0;border:0}.bar .listing-footer>img{top:0}.bar-listing-footer{box-shadow:-4px 6px 4px 6px}input.ng-dirty.ng-invalid,textarea.ng-dirty.ng-invalid{border:2px solid red}.propertylisting-add-images-box{display:inline-block;position:relative}.propertylisting-add-images-box-icon{position:absolute;top:2%;right:0;color:#000 b3}.propertylisting-edit-view-image{display:inline-block;position:relative}.propertylisting-edit-view-image-icon{position:absolute;top:0%;right:4%;color:#000 b3}.propertylisting-edit-view-propertyimage{width:100%;height:50px;border-radius:5%}.propertylisting-edit-view-image-icon-box{float:left;width:25%;padding:1%}.listingedit-property-status{font-size:80%}.listingedit-post-time{font-size:11px;opacity:.7}","propertylisting")