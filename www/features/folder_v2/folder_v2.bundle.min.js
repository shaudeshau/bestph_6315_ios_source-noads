angular.module('starter').controller('Folder2ListController',function($scope,$stateParams,$ionicNavBarDelegate,$timeout,SB,Customer,Folder2,Padlock,$filter){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,search:{searchValue:''},showSearch:!1,searchIndex:[],cardDesign:!1,allowLineReturn:!1,imagePath:function(path){return IMAGE_URL+path}});Folder2.setValueId($stateParams.value_id);$scope.resetSearch=function(){$scope.search={searchValue:''}};$scope.loadContent=function(){Folder2.findAll().then(function(result){if(result&&result.collection){Folder2.populate(result)}
$scope.cardDesign=Folder2.cardDesign;$scope.allowLineReturn=Folder2.allowLineReturn;$scope.showSearch=Folder2.showSearch;$scope.searchIndex=Folder2.searchIndex;var categoryId=_.get($stateParams,'category_id',null);if(_.isEmpty(categoryId)){categoryId=null}
var current=Folder2.fetchForParentId(categoryId);$ionicNavBarDelegate.title(current.folder.title);$timeout(function(){$scope.page_title=current.folder.title});$scope.current=angular.copy(current.folder);$scope.collection=angular.copy(current.subfolders);$scope.chunks2=$filter('chunk')(angular.copy(current.subfolders),2);$scope.chunks3=$filter('chunk')(angular.copy(current.subfolders),3)}).then(function(data){$scope.is_loading=!1})};$scope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.loadContent()});$scope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$scope.loadContent()});$scope.$on(SB.EVENTS.PADLOCK.unlockFeatures,function(){$scope.loadContent()});$scope.$on(SB.EVENTS.PADLOCK.lockFeatures,function(){$scope.loadContent()});$scope.loadContent()});angular.module('starter').factory('Folder2',function($pwaRequest,Customer,Padlock){var factory={value_id:null,folder_id:null,categories:[],searchIndex:[],showSearch:!1,allowLineReturn:!1,extendedOptions:{}};factory.setValueId=function(valueId){factory.value_id=valueId};factory.setExtendedOptions=function(options){factory.extendedOptions=options};factory.populate=function(payload){factory.collection=payload.collection;factory.showSearch=payload.showSearch;factory.allowLineReturn=payload.allowLineReturn;factory.cardDesign=payload.cardDesign;factory.searchIndex=payload.searchIndex;factory.filterAccess()};factory.filterAccess=function(){var unlocked=Customer.can_access_locked_features||Padlock.unlocked_by_qrcode;var compute=function(collection){var destination=[];angular.forEach(collection,function(folderItem){if(!folderItem.is_active){return}
if(unlocked||!folderItem.is_locked||(folderItem.code==='padlock')){if(unlocked&&(folderItem.code==='padlock')){return}
this.push(folderItem)}},destination);return destination};var computeIndex=function(collection){var destination=[];angular.forEach(collection,function(folderItem){if(!folderItem.feature.is_active){return}
if(unlocked||!folderItem.feature.is_locked||(folderItem.feature.code==='padlock')){if(unlocked&&(folderItem.feature.code==='padlock')){return}
this.push(folderItem)}},destination);return destination};factory.collection=compute(angular.copy(factory.collection));factory.searchIndex=computeIndex(angular.copy(factory.searchIndex))};factory.findAll=function(valueId){var localValueId=(valueId===undefined)?this.value_id:valueId;if(!localValueId){return $pwaRequest.reject('[Factory::Folder2.findAll] missing value_id')}
var payload=$pwaRequest.getPayloadForValueId(factory.value_id);if(payload!==!1){factory.populate(payload);return $pwaRequest.resolve()}
return $pwaRequest.get('folder2/mobile_list/findall',{urlParams:{value_id:localValueId}})};factory.fetchForParentId=function(parentId){var currentFolder;if(parentId===null){currentFolder=_.find(factory.collection,{parent_id:null})}else{currentFolder=_.find(factory.collection,{category_id:parseInt(parentId,10)})}
return{folder:currentFolder,subfolders:_.filter(factory.collection,{parent_id:parseInt(currentFolder.category_id,10)})}};return factory});Features.insertCSS("","folder_v2")