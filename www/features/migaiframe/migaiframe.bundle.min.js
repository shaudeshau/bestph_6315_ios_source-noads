angular.module('starter').controller('MigaiframeViewController',function($cordovaBarcodeScanner,$cordovaClipboard,$ionicHistory,$scope,$timeout,$translate,$window,Dialog,$stateParams,$location,$sce,$state,Application,Migaiframe,Loader){$scope.is_loading=!0;Loader.show();$scope.main_url='';$scope.loading_spinner_delay=5000;Migaiframe.value_id=$stateParams.value_id;$scope.scan_protocols=['tel:','http:','https:','geo:','smsto:','mailto:','ctc:'];$scope.is_protocol_found=!1;$scope.migaiframe=null;$scope.ios_styles={'height':'100%'};$scope.title_styles={};$scope.is_scanner_opened=!1;$scope.loadContent=function(){$scope.title_styles={'left':'0px','right':'0px'};Migaiframe.find().then(function(data){if(data.migaiframe.url===undefined||typeof data.migaiframe.url==="undefined"){$scope.is_loading=!1;Loader.hide();$scope.goToHomePage()}
$scope.migaiframe=data.migaiframe;$scope.loading_spinner_delay=parseInt($scope.migaiframe.loading_spinner_delay)*1000;$scope.main_url=$scope.migaiframe.url;$scope.migaiframe.url=$sce.trustAsResourceUrl($scope.migaiframe.url);$scope.migaiframe.is_qr_ean=parseInt($scope.migaiframe.is_qr_ean,10);$scope.page_title=data.page_title;$scope.migaiframe.icon=(data.migaiframe.icon)?IMAGE_URL+'images/application/'+data.migaiframe.icon:!1;if(ionic.Platform.isIOS()){$scope.ios_styles={'overflow-y':'scroll','-webkit-overflow-scrolling':'touch','height':'100%'}}}).then(function(){})};$scope.goToFrameMainPage=function(){var current_url=$sce.getTrustedResourceUrl($scope.migaiframe.url);if(current_url===$scope.main_url){$scope.migaiframe.url=$sce.trustAsResourceUrl(current_url+' ')}else{$scope.migaiframe.url=$sce.trustAsResourceUrl($scope.main_url)}};$scope.goToHomePage=function(){$state.go('home')};$scope.openScanner=function(){$cordovaBarcodeScanner.scan().then(function(barcodeData){if(!barcodeData.cancelled&&barcodeData.text!==''&&!$scope.is_scanner_opened){$scope.is_scanner_opened=!0;$timeout(function(){for(var i=0;i<$scope.scan_protocols.length;i++){if(barcodeData.text.toLowerCase().indexOf($scope.scan_protocols[i])==0){if($scope.scan_protocols[i]=="http:"||$scope.scan_protocols[i]=="https:"){$window.open(barcodeData.text,"_blank","location=yes")}else{var content_url=barcodeData.text;if($scope.scan_protocols[i]=="smsto:"&&ionic.Platform.isIOS()){content_url=url.replace(/(smsto|SMSTO):/,"sms:").replace(/([0-9]):(.*)/,"$1")}else if($scope.scan_protocols[i]==='geo:'&&ionic.Platform.isIOS()){content_url=url.replace(/(geo|GEO):/,'https://maps.apple.com/?q=')}
$window.open(content_url,'_blank','location=no')}
$scope.is_protocol_found=!0;$scope.is_scanner_opened=!1;break}else if($scope.scan_protocols[i]==='ctc:'){var buttons=['OK'];Dialog.confirm('Scan result',barcodeData.text,buttons,'text-center').then(function(res){var tmpString=$scope.migaiframe.query_string.replace('@@qr_ean@@',barcodeData.text);$scope.migaiframe.url=$sce.trustAsResourceUrl(tmpString)});$scope.is_scanner_opened=!1;$scope.is_protocol_found=!0;break}}
if(!$scope.is_protocol_found){Dialog.alert('Scan result',barcodeData.text,'OK');$scope.is_scanner_opened=!1}})}},function(error){Dialog.alert('Error','An error occurred while reading the code.','OK');$scope.is_scanner_opened=!1})};window.iframeLoaded=function(){$timeout(function(){$scope.is_loading=!1;Loader.hide()},$scope.loading_spinner_delay)}
$scope.loadContent()});angular.module('starter').factory('Migaiframe',function($pwaRequest){var factory={value_id:null};factory.find=function(){if(!this.value_id){return}
return $pwaRequest.get('migaiframe/mobile_view/find',{urlParams:{value_id:this.value_id}})};return factory});Features.insertCSS("","migaiframe")