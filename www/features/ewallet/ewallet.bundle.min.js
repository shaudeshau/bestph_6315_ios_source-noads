angular.module('starter').controller('EwalletController',function(Dialog,Application,Ewallet,SB,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.page_title='My Wallet';$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$scope.homedatas={};$scope.application={};$scope.currentBalance=Ewallet.currentBalance='0.0';$scope.currency_code=null;$scope.recent_collection={};Ewallet.setCart({});$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.loadContent();$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer});$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$scope.loadContent();$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer});$scope.login=function(){Customer.loginModal($scope)}
$scope.loadContent=function(){$scope.is_loading=!0;$scope.application=Application;Ewallet.findall().success(function(data){$scope.homedatas.sliders=data.sliders;Ewallet.currency_code=data.currency_code;$scope.currency_code=data.currency_code;$scope.settings=data.settings;Ewallet.setSettings(data.settings);console.log('settings',$scope.settings);if(Customer.isLoggedIn()){Ewallet.currentBalance=data.customer_wallet.balance;$scope.currentBalance=data.customer_wallet.balance;$scope.recent_collection=data.recent_collection}}).error(function(){$scope.is_loading=!1}).finally(function(){$scope.is_loading=!1})}
$scope.loadContent();$scope.sliderImages=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/application'+image}};$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/ewallet/assets/media/customer-placeholder.png"}};$scope.$on('$ionicView.enter',function(scopes,states){if(Customer.isLoggedIn()){}});$scope.tnxDetails=function(values){Ewallet.setDetails(values);$state.go("ewallet-history-details",{value_id:$scope.value_id})}});angular.module('starter').controller('EwalletMyQRController',function(Dialog,Ewallet,SB,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.loadContent();$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer});$scope.login=function(){Customer.loginModal($scope)}
$scope.loadContent=function(){}
$scope.generateqrCode=function(){return Ewallet.generateqrCode()}
$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/ewallet/assets/media/customer-placeholder.png"}};$scope.loadContent()}).controller('EwalletHistoryController',function(Dialog,Ewallet,SB,Application,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.collection=[];$scope.can_load_older_posts=!1;$scope.currency_code=Ewallet.currency_code;$scope.loadHistory=function(){$scope.is_loading=!0;Loader.show();Ewallet.findallHistory($scope.collection.length).success(function(data){$scope.can_load_older_posts=!!data.collection.length;$scope.collection=$scope.collection.concat(data.collection);$scope.is_loading=!1;Loader.hide();$rootScope.$broadcast("refreshPageSize")}).error(function(error){Loader.hide();$scope.is_loading=!1;$scope.can_load_older_posts=!1;Dialog.alert($translate.instant("Error","ewallet"),error.message,"OK",-1,"ewallet")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.loadHistory();$scope.loadMore=function(){if(!$scope.collection.length){return!1}
Ewallet.findallHistory($scope.collection.length).success(function(data){$scope.can_load_older_posts=!!data.collection.length;$scope.collection=$scope.collection.concat(data.collection);$rootScope.$broadcast("refreshPageSize")}).error(function(error){$scope.can_load_older_posts=!1;Dialog.alert($translate.instant("Error","ewallet"),error.message,"OK",-1,"ewallet")}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.tnxDetails=function(values){Ewallet.setDetails(values);$state.go("ewallet-history-details",{value_id:$scope.value_id})}}).controller('EwalletHistoryDetailsController',function(Dialog,Ewallet,Application,SB,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.transaction=Ewallet.getDetails();$scope.currency_code=Ewallet.currency_code;$scope.application=Application});angular.module('starter').controller('EwalletPayContactController',function(Dialog,Ewallet,SB,Application,$rootScope,$cordovaBarcodeScanner,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$scope.recent_customers=[];$scope.search_collection=[];$scope.can_load_older_posts=!1;$scope.is_loading=!1;$scope.is_active_remark=!1;$scope.myObj={search:""};$scope.inputdata={amount:"",remark:""};$scope.forTranslate=function(text){return $translate.instant(text,"ewallet")};$scope.addToCard=function(customer_id){if(customer_id==Customer.id){Dialog.alert($translate.instant("Error","ewallet"),$translate.instant('Money can not be transfer in same account!',"ewallet"),$translate.instant("Ok","ewallet"),-1);return!1}
$scope.cart=Ewallet.getPaycart();$scope.cart.customer_id=customer_id;$scope.cart.currency_code=Ewallet.currency_code;$scope.cart.method="payToCustomer";var selectedUser=$filter('filter')($scope.search_collection,{customer_id:customer_id});$scope.cart.firstname=selectedUser[0].firstname;$scope.cart.lastname=selectedUser[0].lastname;$scope.cart.email=selectedUser[0].email;Ewallet.setPaycart($scope.cart);$state.go("ewallet-pay-amount",{value_id:$scope.value_id})}
$scope.searchContactDirectory=function(){$scope.search_collection=[];Ewallet.searchText=$scope.myObj.search;if(!Ewallet.validateEmail($scope.myObj.search))return!1;$scope.is_loading=!0;Ewallet.searchCustomer($scope.myObj.search).success(function(data){$scope.search_collection=[];$scope.search_collection=$scope.search_collection.concat(data.collection)}).error(function(){$scope.search_collection=[];$scope.is_loading=!1}).finally(function(){$scope.is_loading=!1})};$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/phonebook/assets/templates/images/customer-placeholder.png"}};$scope.openScanCamera=function(){if(!Application.is_webview){$scope.scan_protocols=['sendback:'];$scope.showScanCamera()}else{Dialog.alert($translate.instant("Info","ewallet"),$translate.instant("This will open the code scan camera on your device","ewallet"),$translate.instant("Ok","ewallet"),-1)}};$scope.showScanCamera=function(){$cordovaBarcodeScanner.scan().then(function(barcodeData){if(!barcodeData.cancelled&&(barcodeData.text!=='')){$timeout(function(){var barcodeDataText=barcodeData.text;$scope.cart=Ewallet.getPaycart();$scope.cart.currency_code=Ewallet.currency_code;Loader.show()
Ewallet.verifyQrCodeInfo(barcodeDataText).success(function(data){if(data.success){if(data.method=='payToCustomer'){$scope.cart.method=data.method;$scope.cart.customer_id=data.customer_id;$scope.cart.firstname=data.firstname;$scope.cart.lastname=data.lastname;$scope.cart.email=data.email}
if(data.method=='payToStore'){$scope.cart.method=data.method;$scope.cart.store_id=data.storeId;$scope.cart.firstname=data.storeName;$scope.cart.email=data.storeemail}
Ewallet.setPaycart($scope.cart);$state.go("ewallet-pay-amount",{value_id:$scope.value_id})}else{Dialog.alert($translate.instant("Error","ewallet"),data.message,'OK',-1)}
Loader.hide()}).error(function(error){Dialog.alert($translate.instant("Error","ewallet"),error.message,'OK',-1);Loader.hide()})})}else{Dialog.alert($translate.instant("Error","ewallet"),$translate.instant("Unreadable QRCode, sorry","ewallet"),"OK",-1,"ewallet")}},function(error){Dialog.alert('Error','An error occurred while reading the code.','OK',-1)})};$scope.isActiveRemark=function(){$scope.is_active_remark=!0}
$scope.clearSearch=function(){$scope.myObj.search=''}}).controller('EwalletPayAmountController',function(Dialog,Ewallet,SB,Application,$rootScope,$cordovaBarcodeScanner,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.cart={};$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/phonebook/assets/templates/images/customer-placeholder.png"}};$scope.loadContent=function(){$scope.cart=Ewallet.getPaycart();if(!Ewallet.isUndefined($scope.cart.amount)){$scope.cart.amount="";$scope.cart.remark=""}};$scope.loadContent();$scope.addToCard=function(){Ewallet.setPaycart($scope.cart);$state.go("ewallet-pay-checkout",{value_id:$scope.value_id})}}).controller('EwalletPayCheckoutController',function(Dialog,Ewallet,SB,Application,$rootScope,$cordovaBarcodeScanner,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal,$ionicHistory){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.cart={};$scope.application=Application;$scope.current_balance=Ewallet.currentBalance;$scope.is_low_balance=!1;$scope.is_submiting=!1;$scope.goToAddWallet=function(){Ewallet.setPaycart($scope.cart);$scope.tempCart={};$scope.tempCart.amount=$scope.cart.required_more_amount;$scope.tempCart.currency_code=$scope.cart.currency_code;$scope.tempCart.currency_code=$scope.cart.currency_code;$scope.tempCart.redirectTo="checkout";Ewallet.setCart($scope.tempCart);$state.go("ewallet-pay-procced",{value_id:$scope.value_id})}
$scope.callCustomerPay=function(){Loader.show();$scope.is_submiting=!0;$scope.cart=Ewallet.getPaycart();Ewallet.payToCustomerNow($scope.cart).success(function(data){$scope.cart.status=data.status;$scope.cart.txnId=data.txnId;$scope.cart.datetime=data.datetime;$scope.cart.newbalance=data.newbalance;Ewallet.setCart($scope.cart);$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});$state.go('home').then(function(){$state.go("ewallet",{value_id:$scope.value_id},{reload:!0}).then(function(){Ewallet.setCart($scope.cart);$state.go("ewallet-pay-thankyou",{value_id:$scope.value_id},{reload:!0})})});Loader.hide()}).error(function(){$scope.is_submiting=!1;Loader.hide()}).finally(function(){})}
$scope.callStorePay=function(){Loader.show();$scope.is_submiting=!0;$scope.cart=Ewallet.getPaycart();Ewallet.payToStoreNow($scope.cart).success(function(data){$scope.cart.status=data.status;$scope.cart.txnId=data.txnId;$scope.cart.datetime=data.datetime;$scope.cart.newbalance=data.newbalance;Ewallet.setCart($scope.cart);$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});$state.go('home').then(function(){$state.go("ewallet",{value_id:$scope.value_id},{reload:!0}).then(function(){Ewallet.setCart($scope.cart);$state.go("ewallet-pay-thankyou",{value_id:$scope.value_id},{reload:!0})})});Loader.hide()}).error(function(){$scope.is_submiting=!1;Loader.hide()}).finally(function(){})}
$scope.payToCustomerNow=function(){$scope.cart=Ewallet.getPaycart();$scope.cart.payment_method='wallet';Ewallet.setPaycart($scope.cart);if($scope.cart.method=='payToStore'){$scope.callStorePay()}
if($scope.cart.method=='payToCustomer'){$scope.callCustomerPay()}}
$scope.loadContent=function(){$scope.cart=Ewallet.getPaycart();$scope.cart.current_balance=Ewallet.currentBalance;if($scope.cart.current_balance>=$scope.cart.amount){$scope.cart.amount_debit_from_wallet=$scope.cart.amount}
if($scope.cart.current_balance<$scope.cart.amount){$scope.cart.amount_debit_from_wallet=$scope.cart.current_balance;$scope.cart.required_more_amount=($scope.cart.amount-$scope.cart.current_balance);$scope.is_low_balance=!0}
Ewallet.setPaycart($scope.cart)};$scope.loadContent()}).controller('EwalletTransferController',function(Dialog,Ewallet,SB,Application,$rootScope,$cordovaBarcodeScanner,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn()}).controller('EwalletTransferPlcController',function(Dialog,Ewallet,SB,$ionicHistory,Application,$rootScope,$cordovaBarcodeScanner,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.cart={};$scope.cart.currency_code=Ewallet.currency_code;$scope.cart.current_balance=Ewallet.currentBalance;$scope.current_balance=Ewallet.currentBalance;$scope.cart.amount='';$scope.transferPlcNow=function(){if($scope.cart.amount>$scope.current_balance){Dialog.alert($translate.instant("Error","ewallet"),$translate.instant("Please enter amount must be less than or equal to available wallet amount!","ewallet"),"OK",-1,"ewallet");return!1}
Loader.show();Ewallet.transferPlcNow($scope.cart).success(function(data){Loader.hide();Dialog.alert($translate.instant("Success","ewallet"),data.message,"OK",-1,"ewallet").then(function(){$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});$state.go('home').then(function(){$state.go("ewallet",{value_id:$scope.value_id},{reload:!0})})})}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","ewallet"),error.message,"OK",-1,"ewallet");return!1;Loader.hide()})}});angular.module('starter').controller('EwalletAddMoneyController',function(Dialog,Ewallet,Application,SB,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$scope.application={};$scope.cart={currency_code:Ewallet.currency_code,amount:'',promo_status:!1};$scope.current_balance=Ewallet.currentBalance;$scope.loadContent=function(){$scope.application=Application;$scope.cartold=Ewallet.getCart();$scope.settings=Ewallet.getSettings();if(!Ewallet.isUndefined($scope.cartold.amount)){$scope.cart=$scope.cartold}
Ewallet.setCart($scope.cart)}
$scope.loadContent();$scope.addToCard=function(){if($scope.cart.amount<$scope.settings.min_transaction_amount){Dialog.alert($translate.instant("Info","ewallet"),$translate.instant("Please enter amount greater or equal to "+$scope.settings.min_transaction_amount,"ewallet"),"OK",-1,"ewallet");return!1}
if($scope.cart.amount>$scope.settings.max_transaction_amount){Dialog.alert($translate.instant("Info","ewallet"),$translate.instant("Please enter amount less or equal to "+$scope.settings.max_transaction_amount,"ewallet"),"OK",-1,"ewallet");return!1}
$scope.cartNew=Ewallet.getCart();$scope.cartNew.amount=$scope.cart.amount;$scope.cartNew.method='addInWallet';Ewallet.setCart($scope.cartNew);$state.go("ewallet-pay-procced",{value_id:$scope.value_id})}
$scope.removePromocode=function(){$scope.cartNew=Ewallet.getCart();$scope.cartNew.promo_status=!1;Ewallet.setCart($scope.cartNew);$scope.cart=Ewallet.getCart()}
$scope.goToPromocode=function(){$scope.cartNew=Ewallet.getCart();$scope.cartNew.amount=$scope.cart.amount;Ewallet.setCart($scope.cartNew);if($scope.cart.amount>0){$state.go("ewallet-promocode",{value_id:$scope.value_id})}else{Dialog.alert($translate.instant("Error","ewallet"),$translate.instant("Please enter a amount!","ewallet"),"OK",-1,"ewallet")}}}).controller('EwalletProceedController',function(Dialog,Ewallet,SB,$window,Application,$ionicLoading,PaymentStripe,$ionicPlatform,$ionicHistory,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;$scope.cart=Ewallet.getCart();$scope.selectoption={};$scope.is_submiting=!1;$scope.is_loading=!1;$scope.years=[];$scope.formData={};$scope.paymentMethodList=[];$scope.getPublishableKey=function(){Ewallet.fetchSettings().then(function(payload){PaymentStripe.settings=payload.settings},function(error){console.error(error.message)})};$scope.updateRedirect=function(data){$scope.cart.status=data.status;$scope.cart.txnId=data.txnId;$scope.cart.datetime=data.datetime;$scope.cart.newbalance=data.customer_wallet;Ewallet.setCart($scope.cart);$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});$state.go('home').then(function(){$state.go("ewallet",{value_id:$scope.value_id},{reload:!0}).then(function(){Ewallet.setCart($scope.cart);Ewallet.currentBalance=data.customer_wallet;$state.go("ewallet-pay-thankyou",{value_id:$scope.value_id},{reload:!0})})});Loader.hide()}
$scope.loadContent=function(){Loader.show();$scope.is_loading=!0;var current_year=new Date().getFullYear();for(var i=current_year;i<=current_year+20;i++){$scope.years.push({value:i+''})}
if(typeof Stripe==="undefined"){var stripeJS=document.createElement('script');stripeJS.type="text/javascript";stripeJS.src="https://js.stripe.com/v3/";stripeJS.onload=function(){$scope.getPublishableKey()};document.body.appendChild(stripeJS)}else{$scope.getPublishableKey()}
Ewallet.fetchPaymentSettings().then(function(payload){$scope.paymentMethodList=payload.collection;Loader.hide();$scope.is_loading=!1},function(error){Dialog.alert($translate.instant("Error","ewallet"),error.message,"OK",-1,"ewallet");Loader.hide();$scope.is_loading=!1})}
$scope.loadContent();$scope.payStripeNow=function(isValid,formData){if(!isValid){return!1}
Loader.show();$scope.is_submiting=!0;Stripe.setPublishableKey(PaymentStripe.settings.publishable_key);Stripe.card.createToken(formData,function stripeResponseHandler(status,response){if(!Ewallet.isUndefined(response.error)){Dialog.alert($translate.instant("Error","ewallet"),response.error.message,"OK",-1,"ewallet");Loader.hide();$scope.is_submiting=!1;return!1}
var token=response.id;$scope.cart=Ewallet.getCart();$scope.cart.payment_method=$scope.selectoption.method;$scope.cart.secretkey=token;Ewallet.setCart($scope.cart);Ewallet.payByStripeNow($scope.cart).success(function(data){Loader.hide();$scope.updateRedirect(data)}).error(function(error){Dialog.alert($translate.instant("Error","ewallet"),error.message,"OK",-1,"ewallet");$scope.is_submiting=!1;Loader.hide()}).finally(function(){})})}
$scope.updateStatus=function(param){Ewallet.updateTransactionStatus(param).success(function(data){param.customer_wallet=data.customer_wallet;$scope.updateRedirect(param)}).error(function(){param.customer_wallet=Ewallet.currentBalance;$scope.updateRedirect(param)})}
$scope.populateURL=function(param){if(!Application.is_webview){$ionicLoading.show({content:'Please Wait...',animation:'fade-in',showBackdrop:!0,maxWidth:200,showDelay:0});var browser=$window.open(param.token_url,$rootScope.getTargetForLink(),'location=yes');browser.addEventListener('loadstart',function(event){var newurl=event.url.split('/?__goto__=');var res=newurl[0].concat(newurl[1]);if(/(confirm)/.test(event.url)){var url=event.url;var first_split=url.split('?');var second_split=first_split[1].split('&');var token_split=second_split[0].split('=');var tokenId=token_split[1];var payer_split=second_split[1].split('=');var payerId=payer_split[1];if(tokenId!=''&&payerId!=''){$scope.cart=Ewallet.getCart();$scope.cart.status='success';$scope.cart.tokenId=tokenId;$scope.cart.payerId=payerId;Ewallet.setCart($scope.cart);$scope.updateStatus($scope.cart);browser.close();$ionicLoading.hide()}}else if(/(cancel)/.test(event.url)){$scope.cart=Ewallet.getCart();$scope.cart.status='failed';$scope.cart.tokenId='';$scope.cart.payerId='';Ewallet.setCart($scope.cart);$scope.updateStatus($scope.cart);browser.close();$ionicLoading.hide()}})}else{$window.location=param.token_url}}
$scope.payPaypalNow=function(){Loader.show();$scope.is_submiting=!0;$scope.cart=Ewallet.getCart();$scope.cart.payment_method=$scope.selectoption.method;Ewallet.setCart($scope.cart);Ewallet.payByPayPalNow($scope.cart).success(function(data){$scope.is_submiting=!1;if(data.status=='success'){$scope.cart.status=data.status;$scope.cart.txnId=data.txnId;$scope.cart.datetime=data.datetime;$scope.cart.walletHistoryId=data.walletHistoryId;$scope.cart.token_url=data.token_url;Ewallet.setCart($scope.cart);Ewallet.set_local('PAYPAL_BEFORE_DATA',JSON.stringify($scope.cart));$scope.populateURL($scope.cart)}else{$scope.updateRedirect(data)}}).error(function(){Dialog.alert($translate.instant("Error","ewallet"),error.message,"OK",-1,"ewallet");$scope.is_submiting=!1;Loader.hide()}).finally(function(){})}
$scope.payNow=function(){Loader.show();$scope.is_submiting=!0;$scope.cart=Ewallet.getCart();$scope.cart.payment_method=$scope.selectoption.method;Ewallet.setCart($scope.cart);Ewallet.payNow($scope.cart).success(function(data){$scope.updateRedirect(data)}).error(function(){$scope.is_submiting=!1;Loader.hide()}).finally(function(){})}
$scope.range=function(min,max,step){step=step||1;var input=[];for(var i=min;i<=max;i+=step)input.push(i);return input}}).controller('EwalletPaypalReturnController',function(Dialog,Ewallet,SB,$ionicHistory,$ionicLoading,$location,Application,$ionicPlatform,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;Ewallet.setCart(JSON.parse(Ewallet.get_local('PAYPAL_BEFORE_DATA')));Ewallet.unset_local('PAYPAL_BEFORE_DATA');$scope.cart=Ewallet.getCart();Loader.show();$scope.updateRedirect=function(data){$scope.cart.status=data.status;$scope.cart.txnId=data.txnId;$scope.cart.datetime=data.datetime;$scope.cart.newbalance=data.customer_wallet;Ewallet.setCart($scope.cart);console.log('Cart updateRedirect',$scope.cart);$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});$state.go('home').then(function(){$state.go("ewallet",{value_id:$scope.value_id},{reload:!0}).then(function(){Ewallet.setCart($scope.cart);Ewallet.currentBalance=data.customer_wallet;$state.go("ewallet-pay-thankyou",{value_id:$scope.value_id},{reload:!0})})});Loader.hide()}
$scope.updateStatus=function(param){Ewallet.updateTransactionStatus(param).success(function(data){param.customer_wallet=data.customer_wallet;$scope.updateRedirect(param)}).error(function(){param.customer_wallet=Ewallet.currentBalance;$scope.updateRedirect(param)})}
$scope.loadContent=function(){Loader.show();if(Application.is_webview){var url=$location.absUrl();if(url.indexOf("?")>-1){var first_split=url.split('?');var second_split=first_split[1].split('&');if(second_split.length>1){var token_split=second_split[0].split('=');var tokenId=token_split[1];var payer_split=second_split[1].split('=');var payerId=payer_split[1];$scope.cart.status='success';$scope.cart.tokenId=tokenId;$scope.cart.payerId=payerId;Ewallet.setCart($scope.cart);$scope.updateStatus($scope.cart)}else{$scope.cart.status='failed';$scope.cart.tokenId='';$scope.cart.payerId='';Ewallet.setCart($scope.cart);$scope.updateStatus($scope.cart)}}}}
Application.loaded.then(function(){Loader.show();console.log("Application load in ewallet");$scope.loadContent()})}).controller('EwalletThankyouController',function(Dialog,Ewallet,SB,$ionicPlatform,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.customer=Customer.customer;Loader.show();$scope.cart=Ewallet.getCart();Ewallet.setCart({});if(!Ewallet.isUndefined($scope.cart.redirectTo)&&$scope.cart.redirectTo=='checkout'){$scope.cart=Ewallet.getPaycart();$scope.cart.autosubmit='yes';Ewallet.setPaycart($scope.cart);$state.go("ewallet-pay-checkout",{value_id:$scope.value_id});Loader.hide()}else{Ewallet.setPaycart({});Loader.hide()}}).controller('EwalletPromocodeController',function(Dialog,Ewallet,SB,$ionicPlatform,$rootScope,$ionicScrollDelegate,Loader,$timeout,$ionicSlideBoxDelegate,Customer,$scope,$filter,$state,$stateParams,$translate,$ionicModal){$scope.value_id=Ewallet.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.cart=Ewallet.getCart();$scope.cart.promocode='';$scope.applyPromocode=function(){Loader.show();Ewallet.applyPromocode($scope.cart).success(function(data){if(data.status){$scope.cart=Ewallet.getCart();$scope.cart.promocode_id=data.promocode_id;$scope.cart.extra_promo_amount=data.extraPromoAmount;$scope.cart.promo_message=data.message;$scope.cart.promo_status=!0;Ewallet.setCart($scope.cart);console.log(Ewallet.getCart());$state.go("ewallet-addMoney",{value_id:$scope.value_id})}else{Dialog.alert($translate.instant("Error","ewallet"),data.message,"OK",-1,"ewallet")}}).error(function(){$scope.is_submiting=!1;Loader.hide()}).finally(function(){Loader.hide();$scope.is_submiting=!1})}});angular.module('starter').factory('Ewallet',function(Application,$sbhttp,Url,$window,$rootScope,$location,Pages,Customer,$state,$pwaRequest,$ionicPlatform,$session,Dialog,SB,$ionicPopup,$translate){var factory={};factory.value_id=null;factory.searchText='';factory.cart={};factory.paycart={};factory.details={};factory.settings={};factory.currency_code=null;factory.currentBalance='0.0';factory.setDetails=function(details){factory.details=details;return factory};factory.getDetails=function(){return factory.details};factory.setSettings=function(settings){factory.settings=settings;return factory};factory.getSettings=function(){return factory.settings};factory.setCart=function(cart){factory.cart=cart;return factory};factory.getPaycart=function(){return factory.paycart};factory.setPaycart=function(paycart){factory.paycart=paycart;return factory};factory.getCart=function(){return factory.cart};factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.generateqrCode=function(){var myOptions={};return Url.get('/ewallet/mobile_view/generateqrcode',angular.extend({},myOptions,{value_id:factory.value_id}))+($rootScope.isOffline?'':'?'+(+new Date()))};factory.searchCustomer=function(search=null){return $pwaRequest.post('/ewallet/mobile_pay/search-customer',{urlParams:{value_id:factory.value_id,search:search},cache:!1})};factory.findall=function(){return $pwaRequest.post('/ewallet/mobile_view/findall',{urlParams:{value_id:factory.value_id},cache:!1})};factory.payNow=function(param){return $pwaRequest.post('/ewallet/mobile_pay/pay-now',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.verifyQrCodeInfo=function(value){return $pwaRequest.post('/ewallet/mobile_view/verify-qr-code-info',{urlParams:{value_id:factory.value_id},data:{text:value},cache:!1})};factory.payByPayPalNow=function(param){param.is_webview=Application.is_webview;param.current_url=$location.url();param.BASE_PATH=BASE_PATH;return $pwaRequest.post('/ewallet/mobile_pay/pay-by-paypal-now',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.payByStripeNow=function(param){return $pwaRequest.post('/ewallet/mobile_pay/pay-by-stripe-now',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.fetchPaymentSettings=function(){return $pwaRequest.post('/ewallet/mobile_view/fetch-payment-settings',{urlParams:{value_id:factory.value_id},cache:!1})}
factory.updateTransactionStatus=function(param){return $pwaRequest.post('/ewallet/mobile_pay/update-transaction-status',{urlParams:{value_id:factory.value_id},data:param,cache:!1})}
factory.payToCustomerNow=function(param){return $pwaRequest.post('/ewallet/mobile_pay/pay-to-customer-now',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.payToStoreNow=function(param){return $pwaRequest.post('/ewallet/mobile_pay/pay-to-store-now',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.applyPromocode=function(param){return $pwaRequest.post('/ewallet/mobile_pay/apply-promocode',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.findallHistory=function(offset){return $pwaRequest.post('/ewallet/mobile_view/findall-history',{urlParams:{value_id:factory.value_id,offset:offset},cache:!1})};factory.transferPlcNow=function(param){return $pwaRequest.post('/ewallet/mobile_pay/transfer-plc-point',{urlParams:{value_id:factory.value_id},data:param,cache:!1})};factory.validateEmail=function(inputText){var mailformat=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;if(inputText.match(mailformat)){return!0}else{return!1}};factory.isUndefined=function(thing){return(typeof thing==="undefined")}
factory.fetchSettings=function(){return $pwaRequest.post("/paymentstripe/mobile_cards/fetch-settings")};factory.get_local=function(key){return $window.localStorage.getItem(key)||null}
factory.set_local=function(key,id){$window.localStorage.setItem(key,id)}
factory.unset_local=function(key){$window.localStorage.removeItem(key)}
return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.ewallet h2.ewallet-balance{font-size:26px;font-weight:600;text-align:right}.ewallet p.ewallet-balance-title{text-align:right;opacity:.3}.ewallet .list.ewallet-balance-box{margin-bottom:0}.ewallet .ewallet-menu-item .row{padding:0}.ewallet ion-content#ewallet-content .item{border-width:0}.ewallet .rotate-45{transform:rotate(45deg)}.ewallet .rotate-90{transform:rotate(90deg)}.ewallet .rotate-135{transform:rotate(135deg)}.ewallet .rotate-180{transform:rotate(180deg)}.ewallet .remove-border{border:0}.ewallet .margintop-20{margin-top:20%}.ewallet .remove-margin-bottom{margin-bottom:0}.ewallet.ewallet-enter-amount .item-avatar>img:first-child{right:16px;left:unset}.ewallet.ewallet-enter-amount .item-avatar{padding-left:16px}.ewallet.ewallet-enter-amount h2.customer_name{font-size:18px}.ewallet input.amount-enter-input{font-size:24px}.ewallet .item.amount-enter-item{font-size:24px}.ewallet .add-remark-text{margin-right:10px}.ewallet .font-bold{font-weight:700}.ewallet p.low-balance-warring{font-size:12px}.ewallet p.display-wallet-balance{font-size:12px}.ewallet.ewallet-enter-amount .placeholder-icon:first-child{opacity:.5}.ewallet.ewallet-enter-amount .placeholder-icon:first-child.opacity-1{opacity:1}.ewallet.ewallet-add-wallet .placeholder-icon:first-child{opacity:.5}.ewallet.ewallet-add-wallet .placeholder-icon:first-child.opacity-1{opacity:1}.ewallet p.display-available-balnce{font-size:10px}.ewallet .promocode-title{opacity:.7}.ewallet .customer-qr{min-height:200px}.ewallet ::placeholder{opacity:.5}.ewallet .opacity05{opacity:.5}.ewallet p.ewallet-transaction-details-amount{font-size:32px;font-weight:600;text-align:center;min-height:50px}.ewallet p.text-center.thankyou-success-icon{font-size:42px}.ewallet p.text-center.thankyou-payment{font-size:22px;font-weight:700}.ewallet p.thankyou-sentto{margin-top:5%}.ewallet p.thankyou-customername{font-size:18px;font-weight:600;text-transform:uppercase}.ewallet p.thankyou-customeremail{font-size:12px}.ewallet span.error{color:#ff5722;font-size:12px}.ewallet select-error{position:absolute;margin-top:5%}.ewallet .list.stripecard{margin-top:10%}.ewallet .promocode-close{align-items:start}.ewallet p.shot_description{padding:0 10px;margin-top:0;opacity:.5}.ewallet p.thankyou-failed-icon{font-size:40px}","ewallet")