angular.module('starter').controller('PlacesCategoriesController',function($scope,$state,$stateParams,$session,$rootScope,$pwaRequest,Places){angular.extend($scope,{value_id:$stateParams.value_id,settings:null,module_code:'places',currentFormatBtn:'ion-sb-grid-33',currentFormat:'place-100',categories:[],filters:{fulltext:"",categories:null,longitude:0,latitude:0},});Places.setValueId($stateParams.value_id);$scope.nextFormat=function(user){switch($scope.currentFormat){case "place-33":$scope.setFormat("place-50",user);break;case "place-50":$scope.setFormat("place-100",user);break;case "place-100":default:$scope.setFormat("place-33",user);break}};$scope.setFormat=function(format,user){if(user!==undefined){$session.setItem("places_category_format_"+$stateParams.value_id,format)}
switch(format){case "place-33":$scope.currentFormat="place-33";$scope.currentFormatBtn="ion-sb-grid-50";break;case "place-50":$scope.currentFormat="place-50";$scope.currentFormatBtn="ion-sb-list1";break;case "place-100":default:$scope.currentFormat="place-100";$scope.currentFormatBtn="ion-sb-grid-33";break}};$scope.categoryThumbnailSrc=function(item){if(item.picture&&item.picture.length){return IMAGE_URL+"images/application"+item.picture}
return"./features/places/assets/templates/l1/img/no-category.png"};$scope.selectCategory=function(category){$state.go("places-list",{value_id:$scope.value_id,page_id:$stateParams.page_id,category_id:category.id})};$scope.goToMap=function(){if($rootScope.isNotAvailableOffline()){return}
$state.go('places-list-map',{value_id:$scope.value_id,page_id:$stateParams.page_id})};$pwaRequest.get("places/mobile_list/fetch-settings",{urlParams:{value_id:$scope.value_id,t:Date.now()},cache:!1}).then(function(payload){$scope.settings=payload.settings;Places.settings=payload.settings;$session.getItem("places_category_format_"+$stateParams.value_id).then(function(value){if(value){$scope.setFormat(value)}else{$scope.setFormat($scope.settings.default_layout)}}).catch(function(){$scope.setFormat($scope.settings.default_layout)});$scope.categories=$scope.settings.categories})});angular.module('starter').controller("PlacesListController",function(Location,$q,$scope,$rootScope,$session,$state,$pwaRequest,$stateParams,$translate,$timeout,Places,Dialog,Modal){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,settings:null,collection:[],load_more:!1,card_design:!1,module_code:'places',modal:null,currentFormatBtn:'ion-sb-grid-33',currentFormat:'place-100',categories:[],total:0,filters:{fulltext:"",categories:null,longitude:0,latitude:0},});Places.setValueId($stateParams.value_id);$scope.nextFormat=function(user){switch($scope.currentFormat){case "place-33":$scope.setFormat("place-50",user);break;case "place-50":$scope.setFormat("place-100",user);break;case "place-100":default:$scope.setFormat("place-33",user);break}};$scope.setFormat=function(format,user){if(user!==undefined){$session.setItem("places_place_format_"+$stateParams.value_id,format)}
switch(format){case "place-33":$scope.currentFormat="place-33";$scope.currentFormatBtn="ion-sb-grid-50";break;case "place-50":$scope.currentFormat="place-50";$scope.currentFormatBtn="ion-sb-list1";break;case "place-100":default:$scope.currentFormat="place-100";$scope.currentFormatBtn="ion-sb-grid-33";break}};$scope.validateFilters=function(){$scope.closeFilterModal();$scope.collection=[];$scope.searchPlaces()};$scope.closeFilterModal=function(){if($scope.modal){$scope.modal.hide()}};$scope.clearFilters=function(skipSearch){if($scope.categories){$scope.categories.forEach(function(category){category.isSelected=!1})}
$scope.filters.categories=null;$scope.filters.fulltext="";$scope.closeFilterModal();$scope.collection=[];if(skipSearch===undefined){$scope.searchPlaces()}};$scope.filterModal=function(){Modal.fromTemplateUrl("features/places/assets/templates/l1/filter.html",{scope:$scope}).then(function(modal){$scope.modal=modal;$scope.modal.show()})};$scope.imageSrc=function(picture){if(!picture.length){return"./features/places/assets/templates/l1/img/no-category.png"}
return IMAGE_URL+"images/application"+picture};$scope.placeThumbnailSrc=function(item){var url=null;try{switch($scope.settings.listImagePriority){case "thumbnail":default:if(item.thumbnail&&item.thumbnail.length){url=item.thumbnail}else if(item.picture&&item.picture.length){url=item.picture}
break;case "image":if(item.picture&&item.picture.length){url=item.picture}else if(item.thumbnail&&item.thumbnail.length){url=item.thumbnail}
break}
if(url!==null){if(!url.match(/^https?:\/\//)){url=IMAGE_URL+url}
return url}}catch(e){}
return"./features/places/assets/templates/l1/img/no-place.png"};$scope.searchPlaces=function(loadMore){$scope.is_loading=!0;if(Location.isEnabled){Location.getLocation({timeout:10000},!0).then(function(position){$scope.filters.latitude=position.coords.latitude;$scope.filters.longitude=position.coords.longitude},function(){$scope.filters.latitude=0;$scope.filters.longitude=0}).then(function(){$scope.loadPlaces(loadMore,!0)})}else{$scope.filters.latitude=0;$scope.filters.longitude=0;$scope.loadPlaces(loadMore,!0)}};$scope.loadPlaces=function(loadMore){$scope.is_loading=!0;$scope.filters.offset=$scope.collection.length;if($scope.collection.length<=0){$scope.collection=[];Places.collection=[]}
if($scope.categories){$scope.filters.categories=$scope.categories.filter(function(category){return category.isSelected}).map(function(category){return category.id}).join(",")}else{$scope.filters.categories=""}
Places.findAll($scope.filters,!1).then(function(data){Places.collection=Places.collection.concat(angular.copy(data.places));$scope.collection=Places.collection;$scope.load_more=(data.total>$scope.collection.length)}).then(function(){if(loadMore){$scope.$broadcast('scroll.infiniteScrollComplete')}
$scope.is_loading=!1})};$scope.goToMap=function(){if($rootScope.isNotAvailableOffline()){return}
$state.go('places-list-map',{value_id:$scope.value_id})};$scope.showItem=function(item){$state.go('places-view',{value_id:$scope.value_id,page_id:item.id,type:'places'})};$rootScope.$on('location.request.success',function(){$scope.validateFilters()});$pwaRequest.get("places/mobile_list/fetch-settings'",{urlParams:{value_id:$scope.value_id,t:Date.now()},cache:!1}).then(function(payload){$scope.settings=payload.settings;Places.settings=payload.settings;$session.getItem("places_place_format_"+$stateParams.value_id).then(function(value){if(value){$scope.setFormat(value)}else{$scope.setFormat($scope.settings.default_layout)}}).catch(function(){$scope.setFormat($scope.settings.default_layout)});$scope.categories=$scope.settings.categories;if($stateParams.category_id!==undefined){$scope.clearFilters(!0);if($scope.categories){$scope.categories.forEach(function(category){if(category.id==$stateParams.category_id){category.isSelected=!0}})}}
if(Location.isEnabled){Location.getLocation({timeout:10000},!0).then(function(position){$scope.filters.latitude=position.coords.latitude;$scope.filters.longitude=position.coords.longitude},function(error){$scope.filters.latitude=0;$scope.filters.longitude=0}).then(function(){$scope.searchPlaces(!1)})}else{$scope.filters.latitude=0;$scope.filters.longitude=0;$scope.searchPlaces(!1)}})});angular.module('starter').controller('PlacesMapController',function($rootScope,$scope,$state,$stateParams,$translate,$timeout,Location,Places,GoogleMaps){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,collection:[],showInfoWindow:!1,currentPlace:null,filters:{latitude:0,longitude:0,}});Places.setValueId($stateParams.value_id);$scope.goToList=function(){$state.go("places-list",{value_id:$scope.value_id})};$scope.hideInfoWindow=function(){$scope.showInfoWindow=!1};$scope.loadContent=function(){if(Location.isEnabled){Location.getLocation({timeout:10000},!0).then(function(position){$scope.filters.latitude=position.coords.latitude;$scope.filters.longitude=position.coords.longitude},function(){$scope.filters.latitude=0;$scope.filters.longitude=0}).then(function(){$scope.loadContentCallback()})}else{$scope.filters.latitude=0;$scope.filters.longitude=0;$scope.loadContentCallback()}};$scope.loadContentCallback=function(){Places.findAllMaps($scope.filters,!1).then(function(data){$scope.page_title=data.page_title;$scope.collection=data.places;Places.mapCollection=$scope.collection;var markers=[];for(var i=0;i<$scope.collection.length;i=i+1){var place=$scope.collection[i];var marker={config:{id:angular.copy(place.id),place:angular.copy(place)},onClick:(function(marker){$timeout(function(){if(Places.settings.mapAction&&Places.settings.mapAction==='gotoPlace'){$scope.goToPlace(marker.config.place.id)}else{$scope.showInfoWindow=!0;$scope.currentPlace=marker.config.place}})})};if(place.address.latitude&&place.address.longitude){marker.latitude=place.address.latitude;marker.longitude=place.address.longitude}else{marker.address=place.address.address}
switch(place.mapIcon){case "pin":if(place.pin){marker.icon={url:place.pin,width:42,height:42}}
break;case "image":if(place.picture){marker.icon={url:place.picture,width:70,height:44}}
break;case "thumbnail":if(place.thumbnail){marker.icon={url:place.thumbnail,width:42,height:42}}
break;case "default":default:break}
markers.push(marker)}
$scope.map_config={cluster:!0,markers:markers,bounds_to_marker:!0}}).finally(function(){$scope.is_loading=!1})};$scope.loadContent();$rootScope.$on('location.request.success',function(){$scope.loadContent()});$scope.goToPlace=function(placeId){$state.go("places-view",{value_id:$scope.value_id,page_id:placeId})}});angular.module('starter').controller('PlacesViewController',function($filter,$scope,$rootScope,$state,$stateParams,$translate,$location,Places,SocialSharing,Url){angular.extend($scope,{is_loading:!0,value_id:$stateParams.value_id,social_sharing_active:!1,use_pull_to_refresh:!0,pull_to_refresh:!1,card_design:!1});$scope.blankImage="./features/places/assets/templates/l1/img/blank-700-440.png";Places.setValueId($stateParams.value_id);$scope.loadContent=function(){Places.getPlace($stateParams.page_id).then(function(data){$scope.social_sharing_active=(data.social_sharing_active&&$rootScope.isNativeApp);$scope.blocks=data.blocks;$scope.blockChunks=$filter('chunk')(angular.copy($scope.blocks),Math.ceil($scope.blocks.length/2));$scope.place=data.page;$scope.page_title=data.page_title}).then(function(){$scope.is_loading=!1})};$scope.share=function(){var file;var address="";var link=undefined;angular.forEach($scope.blocks,function(block){if(block.gallery){if(block.gallery.length>0&&file===null){file=block.gallery[0].url}}
if(block.type==="address"){address=block.address;if(block.website!==""&&block.show_website){link=block.website}}});var message="Check this place!\n"+$scope.place.title+"\n"+address;SocialSharing.share(undefined,message,undefined,link,file)};$scope.onShowMap=function(block){if($rootScope.isNotAvailableOffline()){return}
var params={};if(block.latitude&&block.longitude){params.latitude=block.latitude;params.longitude=block.longitude}else if(block.address){params.address=encodeURI(block.address)}
params.title=block.label;params.value_id=$scope.value_id;$location.path(Url.get('map/mobile_view/index',params))};$scope.loadContent()});angular.module('starter').factory('Places',function($pwaRequest){var factory={value_id:null,collection:[],mapCollection:[],extendedOptions:{},settings:[]};factory.setValueId=function(value_id){factory.value_id=value_id};factory.setExtendedOptions=function(options){factory.extendedOptions=options};factory.setMapCollection=function(collection){factory.mapCollection=collection};factory.preFetch=function(){factory.findAll()};factory.findAll=function(filters,refresh){if(!this.value_id){return $pwaRequest.reject('[Factory::Places.findAll] missing value_id')}
filters.value_id=this.value_id;return $pwaRequest.get('places/mobile_list/findall',angular.extend({urlParams:filters,refresh:refresh},factory.extendedOptions))};factory.findAllMaps=function(filters,refresh){if(!this.value_id){return $pwaRequest.reject('[Factory::Places.findAll] missing value_id')}
var parameters=angular.extend({value_id:this.value_id,maps:!0},filters);return $pwaRequest.get('places/mobile_list/findall',angular.extend({urlParams:parameters,refresh:refresh},factory.extendedOptions))};factory.find=function(placeId){if(!this.value_id){return $pwaRequest.reject('[Factory::Places.find] missing value_id')}
return $pwaRequest.get('places/mobile_list/find-one',{urlParams:{value_id:this.value_id,place_id:placeId}})};factory.getPlace=function(placeId){if(!this.value_id){return $pwaRequest.reject('[Factory::Places.getPlace] missing value_id')}
var merged=_.union(factory.collection,factory.mapCollection);var place=_.get(_.filter(merged,function(item){return(item.id==placeId)})[0],'embed_payload',!1);if(!place){return factory.find(placeId)}
return $pwaRequest.resolve(place)};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.module-places .places{display:flex;flex-direction:row;flex-flow:row wrap;justify-content:flex-start}.module-places .search-action{position:fixed;z-index:100}.module-places .search-button{position:fixed;bottom:0;z-index:100;margin:0!important}.module-places .svg_filter_text{fill:#fff}.module-places .svg_filter_bg{fill:#ffc900}.module-places .sb-row{display:flex;width:100%;height:100%}.module-places .category-item-block{width:calc(100% \/ 3);padding:1vw}.module-places .category-item-block .category-item{border:2px solid transparent!important;background-size:70%;background-repeat:no-repeat;background-position:center 30%;padding:0!important;margin:0!important}.module-places .category-item-block .category-item img{width:100%}.module-places .category-item-block .category-item h4{position:relative;bottom:.5rem;text-align:center;font-size:.6875rem}.module-places .category-item-block .category-item.category-selected{border:2px solid #444!important}@media screen and (orientation:portrait){.module-places{}.module-places .places{padding-left:2vw}.module-places .places .place:last-of-type{margin-bottom:2vw}.module-places .place-blocks-portrait{display:block}.module-places .place-blocks-landscape{display:none!important}.module-places .place-25{width:25%}.module-places .place-25 .card{height:30vw;margin:2vw 2vw 0 0}.module-places .place-33{width:33.33%}.module-places .place-33 .card{height:16vh;margin:2vw 2vw 0 0}.module-places .place-50{width:50%}.module-places .place-50 .card{height:20vh;margin:2vw 2vw 0 0}.module-places .place-100{width:100%}.module-places .place-100 .card{height:calc((25vw \/ 1.5909) + 2vw);margin:2vw 2vw 0 0}.module-places .place-100 .card .sb-col-20{background-color:#f2f2f2}.module-places .place-100 .card .image{width:100%;height:100%;background-size:cover;background-position:center center}.module-places .place-100 .card .image.category{background-size:auto 80%;background-position:center center;background-repeat:no-repeat}.module-places .place-100 .card .text{width:100%;height:calc((25vw \/ 1.5909) + 2vw);padding:1vw}.module-places .place-100 .card .text .title{font-size:calc((25vw \/ 1.5909) \/ 5);line-height:calc((25vw \/ 1.5909) \/ 4);height:calc((25vw \/ 1.5909) \/ 4)}.module-places .place-100 .card .text .subtitle{font-size:calc(((25vw \/ 1.5909) \/ 4) * 0.7);line-height:calc((25vw \/ 1.5909) \/ 4);height:calc(((25vw \/ 1.5909) \/ 4) * 3);margin:0}.module-places .distance-flex{text-align:center;display:flex;flex-flow:row;height:100%;align-items:center;justify-content:center;background-color:rgba(0,0,0,.08);border-left:1px solid rgba(0,0,0,.1)}.module-places .distance-flex .distance{font-size:calc(25vw \/ 1.5909 \/ 4);line-height:calc(25vw \/ 1.5909 \/ 4)}.module-places .distance-flex .unit{font-size:calc(25vw \/ 1.5909 \/ 6);line-height:calc(25vw \/ 1.5909 \/ 6)}.module-places .distance-flex .stars{font-size:calc((25vw \/ 1.5909) \/ 6);color:gold}.module-places .search-action{width:9vh;height:9vh;bottom:2vh;right:2vh}.module-places .info-window{width:100vw;position:absolute;bottom:0;padding:0 2vw}}@media screen and (orientation:landscape){.module-places{}.module-places .places{padding-left:2vh}.module-places .places .place:last-of-type{margin-bottom:2vh}.module-places .place-blocks-portrait{display:none!important}.module-places .place-blocks-landscape{display:flex}.module-places .place-25{width:25%}.module-places .place-25 .card{height:30vh;margin:2vh 2vh 0 0}.module-places .place-33{width:33.33%}.module-places .place-33 .card{height:20vw;margin:2vh 2vh 0 0}.module-places .place-50{width:50%}.module-places .place-50 .card{height:20vw;margin:2vh 2vh 0 0}.module-places .place-100{width:100%}.module-places .place-100 .card{height:calc((25vh \/ 1.5909) + 2vh);margin:2vh 2vh 0 0}.module-places .place-100 .card .sb-col-20{background-color:#f2f2f2}.module-places .place-100 .card .image{width:100%;height:100%;background-size:cover;background-position:center center}.module-places .place-100 .card .image.category{background-size:auto 80%;background-position:center center;background-repeat:no-repeat}.module-places .place-100 .card .text{width:100%;height:calc((25vh \/ 1.5909) + 2vh);padding:1vh}.module-places .place-100 .card .text .title{font-size:calc((25vh \/ 1.5909) \/ 5);line-height:calc((25vh \/ 1.5909) \/ 4);height:calc((25vh \/ 1.5909) \/ 4)}.module-places .place-100 .card .text .subtitle{font-size:calc(((25vh \/ 1.5909) \/ 4) * 0.7);line-height:calc((25vh \/ 1.5909) \/ 4);height:calc(((25vh \/ 1.5909) \/ 4) * 3);margin:0}.module-places .image-placeholder{height:40vh!important}.module-places .distance-flex{text-align:center;display:flex;flex-flow:row;height:100%;align-items:center;justify-content:center;background-color:rgba(0,0,0,.08);border-left:1px solid rgba(0,0,0,.1)}.module-places .distance-flex .distance{font-size:calc(25vh \/ 1.5909 \/ 4);line-height:calc(25vh \/ 1.5909 \/ 4)}.module-places .distance-flex .unit{font-size:calc(25vh \/ 1.5909 \/ 6);line-height:calc(25vh \/ 1.5909 \/ 6)}.module-places .distance-flex .stars{font-size:calc((25vh \/ 1.5909) \/ 6);color:gold}.module-places .search-action{width:9vw;height:9vw;bottom:2vw;right:2vw}.module-places .place-blocks{display:flex;flex-direction:column;flex-flow:column;justify-content:flex-start;width:50vw;float:left}.module-places .place-header{margin-bottom:0!important}.module-places .place-block .card{margin-bottom:0!important}.module-places .category-item-block{width:calc(100% \/ 6);padding:1vh}.module-places .category-item-block .category-item{width:100%}.module-places .info-window{width:50vw;position:absolute;bottom:0;left:0;padding:0 2vw}}.module-places .text .subtitle{display:none}.module-places .card{padding:0!important}.module-places .card .text{padding:.5rem;font-size:.75rem;line-height:1rem}.module-places .card .text .title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.module-places .sb-col-20{flex:0 0 20%;max-width:20%}.module-places .sb-col-60{flex:0 0 60%;max-width:60%}.module-places .sb-col-80{flex:0 0 80%;max-width:80%}.module-places .place-100 .card .text .title{margin-bottom:0}.module-places .place-100 .card .text .subtitle{display:block!important;overflow:hidden;text-overflow:ellipsis}.module-places .place-33 .card .image,.module-places .place-50 .card .image{width:100%;height:calc(100% - 2rem);background-size:cover;background-position:center center}.module-places .place-33 .card .image.category,.module-places .place-50 .card .image.category{background-size:auto 80%;background-position:center center;background-repeat:no-repeat}.module-places .place-33 .card .text,.module-places .place-50 .card .text{width:100%;height:2rem}.module-places .place-100 .card .text .title{font-weight:700}.module-places .place .card .text{color:#444;background-color:#fff}.module-places .place .card .image{background-color:#f2f2f2}.module-places .place .card .distance-flex{color:#444;background-color:#f2f2f2}.module-places .cover-place{background-size:cover}.module-places .sb-cms-address-label{display:none!important}.module-places .sb-cms-block-address .item{border-top:0!important;border-bottom:0!important;margin:0!important}.module-places .sb-cms-block-address .item a,.module-places .sb-cms-block-address .item p{font-size:0.9rem!important;line-height:1.2rem!important;text-decoration:none!important}.module-places .sb-cms-block-address .item i.icon{font-size:1.25rem!important;opacity:0.75!important}.module-places .sb-place-block-image .description{font-size:.9rem;padding:.75rem .75rem 0 .75rem;border-bottom:0}.module-places .sb-place-block-image .item-image-gallery{border-top:0}.module-places .sb-place-block-image .item-image-gallery .gallery-view .image-container{border:2px solid transparent!important}.module-places .cover-place .place-title{position:absolute;bottom:2vh;left:0;z-index:100;color:#fff;font-weight:700;text-align:left;display:inline-block}.module-places .cover-place .place-title .span-title{background:rgba(25,0,0,.6);max-width:calc(100vw + 2px);overflow:hidden;text-overflow:ellipsis;padding:.25rem 2vh .25rem 2vh;display:inline-block}.module-places .cover-place .place-title .span-subtitle{font-size:.75rem;background:rgba(25,0,0,.6);max-width:calc(100vw + 2px);overflow:hidden;text-overflow:ellipsis;padding:.25rem 2vh .25rem 2vh;display:inline-block}.module-places .places-filters{margin-bottom:0!important}.module-places .places-filters .card{padding:0!important;margin:1vw!important}.module-places .categories-container{display:flex;flex-direction:row;flex-flow:row wrap;justify-content:flex-start;padding:0!important;padding-bottom:60px!important}.module-places i.clear-text{position:absolute;right:1.5rem;top:calc(50% - .625rem);font-size:1.25rem}.module-places .info-window .item{padding-top:10px;padding-bottom:10px;margin:-1px 0!important;border-top:0;border-bottom:0}.module-places .info-window .info-window-icon{padding:10px;border-bottom:0}.module-places .info-window .info-window-icon span{font-size:.85rem;font-weight:700;width:85%;display:inline-block}.module-places .info-window .info-window-icon span.info-window-title{padding-left:8px;padding-bottom:6px}.module-places .info-window .info-window-icon span.info-window-more,.module-places .info-window .info-window-icon span.info-window-distance{font-size:.7rem;width:auto}.module-places .info-window .info-window-icon span.info-window-distance{padding-left:8px}.module-places .info-window .info-window-icon i.info-close{position:absolute;right:10px;top:8px}.module-places i.button-share:before{font-size:1.25rem!important}button.places-secondary-button{margin-left:8px!important}.places-location-action:before{font-size:22px!important}@media screen and (orientation:landscape){.has-footer-fixed .module-places .search-action{bottom:calc(2vw + 60px)}}@media screen and (orientation:portrait){.has-footer-fixed .module-places .search-action{bottom:calc(2vh + 60px)}}","places")