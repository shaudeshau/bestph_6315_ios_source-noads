angular.module('starter').controller('Form2HomeController',function($ionicScrollDelegate,$window,$scope,$stateParams,$timeout,$translate,$filter,Form2,Loader,Dialog,Modal,Customer){angular.extend($scope,{isLoading:!0,value_id:$stateParams.value_id,pageTitle:'Form 2',originalFields:{},cardDesign:!1,fields:{},valueId:0,currentTab:'form',modalResult:null});Form2.setValueId($stateParams.value_id);$scope.pristineFields=function(){$scope.fields=angular.copy($scope.originalFields);$scope.sections=$scope.buildSections($scope.fields)};$scope.setTab=function(tab){$timeout(function(){$scope.currentTab=tab;if(tab==='history'){$ionicScrollDelegate.scrollTop(!1)}})};$scope.validateSection=function(sections){let hasOneValidField=!1;sections.forEach(function(checkField){if(checkField.type!=='spacer'){hasOneValidField=!0}});return hasOneValidField};$scope.displayModal=function(fieldSet){var fields=angular.copy(fieldSet.payload);var sections=$scope.buildSections(fieldSet.payload);var title=$filter('moment_calendar')(fieldSet.timestamp*1000);Modal.fromTemplateUrl('./features/form_v2/assets/templates/l1/form/display-modal.html',{scope:angular.extend($scope.$new(),{modalFields:fields,modalSections:sections,modalTitle:title,modalFormatLocation:function(field){if(!field.is_checked){return''}
var html;if(field.value.address){html=field.value.address+'<br />'+field.value.coords.lat+', '+field.value.coords.lng}else{html=field.value.coords.lat+', '+field.value.coords.lng}
return $filter('trusted_html')(html)},modalClose:function(){$scope.modalResult.remove()}}),animation:'slide-in-right-left'}).then(function(modal){$scope.modalResult=modal;$scope.modalResult.show();return modal})};$scope.submitDate=function(timestamp){return $filter('moment_calendar')(timestamp*1000)};$scope.buildSections=function(fields){var sections=[];var _tmpSection=[];fields.forEach(function(field){if(field.type==='divider'){if(_tmpSection.length>0&&$scope.validateSection(_tmpSection)){sections.push(_tmpSection)}
_tmpSection=[]}
_tmpSection.push(field)});if(_tmpSection.length>0&&$scope.validateSection(_tmpSection)){sections.push(_tmpSection)}
return sections};$scope.getImageSrc=function(image){if(!image.length){return"./features/form_v2/assets/templates/l1/img/no-image.png"}
return IMAGE_URL+'images/application'+image};$scope.checkValue=function(field){field.value+='';field.value=field.value.replace(/[^0-9\.,\-]/,'')};$scope.formIsValid=function(){var required=['number','password','text','textarea','date','datetime','clickwrap','select'];var isValid=!0;var invalidFields=[];$scope.fields.forEach(function(field){if(required.indexOf(field.type)>=0&&field.is_required){if(field.type==='clickwrap'&&field.value!==!0){invalidFields.push('&nbsp;-&nbsp;'+field.label);isValid=!1}else if(field.type==='number'){var current=parseFloat(field.value);if(!Number.isFinite(current)){text=$translate.instant('is not a number','form2');invalidFields.push('&nbsp;-&nbsp;'+field.label+' '+text);isValid=!1}
var min=Number.parseInt(field.min);var max=Number.parseInt(field.max);var step=parseFloat(field.step);var text;if(current<min||current>max){text=$translate.instant('is not inside range','form2')+' '+min+'-'+max;invalidFields.push('&nbsp;-&nbsp;'+field.label+' '+text);isValid=!1}
if(step!==0&&!Number.isInteger(current/step)){text=$translate.instant('must match increment','form2')+' '+step;invalidFields.push('&nbsp;-&nbsp;'+field.label+' '+text);isValid=!1}}else if(field.value===undefined||(field.value+'').trim().length===0){invalidFields.push('&nbsp;-&nbsp;'+field.label);isValid=!1}}});if(!isValid){Dialog.alert('Required fields',invalidFields.join('<br />'),'OK',-1,'form2')}
return isValid};$scope.submit=function(){Loader.show($translate.instant('Sending...','woocommerce2'));var isValid=$scope.formIsValid();if(!isValid){Loader.hide();return}
Form2
.submit($scope.fields).then(function(data){$scope.pristineFields();$scope.history=data.history;Dialog.alert('Success',data.message,'OK',3200,'form2')},function(data){Dialog.alert('Error',data.message,'OK',-1,'form2')}).then(function(){Loader.hide()})};$scope.historyIsEnabled=function(){return Customer.isLoggedIn()&&$scope.enableHistory};$scope.populate=function(payload){$scope.originalFields=payload.formFields;$scope.pageTitle=payload.pageTitle;$scope.history=payload.history;$scope.cardDesign=payload.cardDesign;$scope.enableHistory=payload.enableHistory;$scope.pristineFields()};$scope.loadContent=function(){$scope.isLoading=!0;Form2
.find().then($scope.populate,function(error){Dialog.alert('Error',error.message,'OK')}).then(function(){$scope.isLoading=!1})};$scope.loadContent();if($window.overview){$scope.reloadOverview=function(){$scope.isLoading=!0;Form2
.reloadOverview().then($scope.populate,function(error){Dialog.alert('Error',error.message,'OK')}).then(function(){$scope.isLoading=!1})};$window.overview.form_v2=$scope.reloadOverview;$scope.reloadOverview()}});angular.module('starter').directive('form2Location',function(){return{restrict:'E',replace:!1,scope:{field:'='},templateUrl:'./features/form_v2/assets/templates/l1/directive/geolocation.html',link:function(scope){scope.locationIsLoading=!1},controller:function($scope,$filter,Dialog,Location,GoogleMaps){$scope.getLocation=function(){if(!$scope.field.is_checked){$scope.field.value=null;return}
if(Location.isEnabled){$scope.locationIsLoading=!0;Location.getLocation().then(function(position){var lat=Number.parseFloat(position.coords.latitude).toFixed(5);var lng=Number.parseFloat(position.coords.longitude).toFixed(5);$scope.field.value={address:null,coords:{lat:lat,lng:lng}};GoogleMaps.reverseGeocode(position.coords).then(function(results){if(results[0]&&results[0].formatted_address){$scope.field.value.address=results[0].formatted_address}})},function(e){$scope.field.value=null;$scope.field.is_checked=!1}).then(function(){$scope.locationIsLoading=!1})}else{}};$scope.formatLocation=function(){if(!$scope.field.is_checked){return''}
var html;if($scope.field.value.address){html=$scope.field.value.address+'<br />'+$scope.field.value.coords.lat+', '+$scope.field.value.coords.lng}else{html=$scope.field.value.coords.lat+', '+$scope.field.value.coords.lng}
return $filter('trusted_html')(html)}}}});angular.module('starter').directive('form2Pictures',function(){return{restrict:'E',replace:!1,scope:{field:'=',cardDesign:'=?'},templateUrl:'./features/form_v2/assets/templates/l1/directive/pictures.html',link:function(scope){scope.locationIsLoading=!1;if(scope.cardDesign===undefined){scope.cardDesign=!1}
scope.addPictureText='Add a picture';if(scope.field.image_addpicture.length>0){scope.addPictureText=scope.field.image_addpicture}
scope.addAnotherPictureText='Add another picture';if(scope.field.image_addanotherpicture.length>0){scope.addAnotherPictureText=scope.field.image_addanotherpicture}},controller:function($scope,Picture){$scope.takePicture=function(){if($scope.field.value.length>=$scope.field.limit){return}
Picture.takePicture().then(function(success){$scope.addPicture(success.image)})};$scope.addPicture=function(picture){if(!$scope.field.value){$scope.field.value=[]}
$scope.field.value.push(picture)};$scope.removePicture=function(index){$scope.field.value.splice(index,1)}}}});angular.module('starter').directive('form2Clickwrap',function(Application){return{restrict:'E',replace:!1,scope:{field:'=',cardDesign:'=?'},templateUrl:'./features/form_v2/assets/templates/l1/directive/clickwrap.html',link:function(scope){if(scope.cardDesign===undefined){scope.cardDesign=!1}
scope.field.value=!1;scope.modal=null;scope.privacyPolicy='';if(scope.field.clickwrap==='privacy-policy'){scope.privacyPolicy=Application.privacyPolicy.text;if(Application.gdpr.isEnabled){scope.privacyPolicy+='<br /><br />'+Application.privacyPolicy.gdpr}
scope.defaultTitle='Privacy policy'}else{scope.privacyPolicy=scope.field.clickwrap_richtext;scope.defaultTitle=scope.field.label}
scope.modalTitle=scope.defaultTitle;if(scope.field.clickwrap_modaltitle.length>0){scope.modalTitle=scope.field.clickwrap_modaltitle}},controller:function($scope,Modal){$scope.onClick=function(){if(!$scope.field.value){return}
Modal.fromTemplateUrl('./features/form_v2/assets/templates/l1/directive/clickwrap-modal.html',{scope:angular.extend($scope,{close:function(){$scope.modal.remove()}}),animation:'slide-in-right-left'}).then(function(modal){$scope.modal=modal;$scope.modal.show();return modal})}}}});angular.module('starter').factory('Form2',function($pwaRequest){var factory={value_id:null};factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.validateRequest=function(form){return $pwaRequest.post('form2/mobile/submit',{urlParams:{value_id:factory.value_id},data:{form:form,},cache:!1})};factory.find=function(){if(!this.value_id){return $pwaRequest.reject('[Factory::Form2.find] missing value_id')}
var payload=$pwaRequest.getPayloadForValueId(factory.value_id);if(payload!==!1){return $pwaRequest.resolve(payload)}
return $pwaRequest.get('form2/mobile/find',angular.extend({urlParams:{value_id:this.value_id}},factory.extendedOptions))};factory.reloadOverview=function(){return $pwaRequest.post('form2/mobile/find',angular.extend({urlParams:{value_id:this.value_id}},factory.extendedOptions))};factory.submit=function(form){if(!this.value_id){return $pwaRequest.reject('[Factory::Form2.post] missing value_id')}
return $pwaRequest.post('form2/mobile/submit',{urlParams:{value_id:this.value_id},data:{timestamp:Math.round(Date.now()/1000),form:form},timeout:300000,cache:!1})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.module-form2 img.form2-illustration{width:100%;height:auto;display:block}.module-form2 .remove-image-list,.module-form2 .remove-image-card{position:absolute;right:6px;top:6px}.module-form2 .remove-image-list i.icon,.module-form2 .remove-image-card i.icon{font-size:26px}.module-form2 .form2-richtext *{white-space:normal}.module-form2 img.form2-pictures{max-height:15vh;width:auto;max-width:90%;margin:6px auto}.module-form2 .form2-radio .radio-title{padding:5px 15px;font-weight:700}.module-form2 .form2-radio .radio-item .radio-content .item-content{padding:10px 15px;font-size:13px}.module-form2 .form2-radio .radio-item .radio-content .radio-icon{padding:2px 15px}.module-form2 .form2-image .upload-title{padding:5px 15px;font-weight:700}.module-form2 .form2-image .upload-action{padding:10px 15px 10px 54px}.module-form2 .form2-datetime,.module-form2 .form2-date{padding:2px 0 2px 54px}.module-form2 .form2-datetime input[type=\"text\"],.module-form2 .form2-date input[type=\"text\"]{width:100%}.module-form2 .list .form2-radio label .radio-content{border-left:2px solid #444}.module-form2 .card .form2-radio label .radio-content{border-left:2px solid #444}","form_v2")