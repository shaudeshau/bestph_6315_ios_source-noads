angular.module('starter').factory('Phonebook',function($q,Customer,$rootScope,Application,Pages,$log,$pwaRequest,$state,$sbhttp,Url){var factory={value_id:null,settings:{},customers:{},searchText:null,filterText:null,};factory.setValueId=function(valueId){factory.value_id=valueId;return factory};factory.getValueId=function(){return factory.value_id};factory.setCustomers=function(obj){factory.customers=obj};factory.getCustomers=function(){return factory.customers};factory.setSettings=function(obj){factory.settings=obj};factory.getSettings=function(){return factory.settings};factory.setRecentCustomers=function(obj){if(factory.getRecentCustomers()){var customers=factory.getRecentCustomers();customers=customers.concat(obj);localStorage.setItem('phonebook_recent_customers_'+Customer.id,JSON.stringify(customers))}else{var customers=[];customers=customers.concat(obj);localStorage.setItem('phonebook_recent_customers_'+Customer.id,JSON.stringify(customers))}};factory.getRecentCustomers=function(){if(localStorage.getItem('phonebook_recent_customers_'+Customer.id)){return JSON.parse(localStorage.getItem('phonebook_recent_customers_'+Customer.id))}else{return!1}};factory.getSetings=function(){return $pwaRequest.post('/phonebook/mobile_view/setings',{urlParams:{value_id:factory.value_id},cache:!1})};factory.getAllCustomers=function(){return $pwaRequest.post('/phonebook/mobile_view/findall',{urlParams:{value_id:factory.value_id},cache:!1})};factory.findInbox=function(){return $pwaRequest.get('/phonebook/mobile_view/find-inbox',{urlParams:{value_id:factory.value_id},cache:!1})};factory.setfrequently=function(friend_id){return $pwaRequest.post('/phonebook/mobile_view/setfrequently',{urlParams:{value_id:factory.value_id,friend_id:friend_id},cache:!1})};factory.customerInfo=function(customer_id){return $pwaRequest.post('/phonebook/mobile_view/customerinfo',{urlParams:{value_id:factory.value_id,customer_id:customer_id},cache:!1})};factory.saveSettings=function(settings,customer_id){return $pwaRequest.post('/phonebook/mobile_view/save-settings',{urlParams:{value_id:factory.value_id},data:{display_number:settings.display_number,display_email:settings.display_email,display_dob:settings.display_dob,customer_id:customer_id,},cache:!1})};factory.deleteMessage=function(message_id,type){return $pwaRequest.post('/phonebook/mobile_view/delete-message',{urlParams:{value_id:factory.value_id,message_id:message_id,type:type},cache:!1})};factory.findAll=function(offset,search=null,alphabet=null){var params={value_id:this.value_id,offset:offset,search:search,filter:alphabet};return $sbhttp({method:'GET',url:Url.get("phonebook/mobile_view/findall",params),cache:!1,responseType:'json'})};factory.SaveCoverPhoto=function(coverphoto){var params={file:coverphoto,value_id:factory.value_id};return $sbhttp({method:'POST',url:Url.get("phonebook/mobile_view/setcoverphoto"),data:params,cache:!1,responseType:'json'})};factory.SaveCustomerProfile=function(values){var params={about_me:values.about_me,date_of_brith:values.date_of_brith,mobile_number:values.mobile_number,value_id:factory.value_id};return $sbhttp({method:'POST',url:Url.get("phonebook/mobile_view/savecustomerprofile"),data:params,cache:!1,responseType:'json'})};factory.addGalleryPhoto=function(photo){var params={file:photo,value_id:factory.value_id};return $sbhttp({method:'POST',url:Url.get("phonebook/mobile_view/setgalleryphoto"),data:params,cache:!1,responseType:'json'})};factory.saveMessage=function(values){var params={sender_id:values.sender_id,message:values.message,receiver_id:values.receiver_id,value_id:factory.value_id};return $sbhttp({method:'POST',url:Url.get("phonebook/mobile_view/save-message"),data:params,cache:!1,responseType:'json'})};factory.findAllMessages=function(values){var params={sender_id:values.sender_id,receiver_id:values.receiver_id,value_id:factory.value_id};return $sbhttp({method:'POST',url:Url.get("phonebook/mobile_view/find-all-messages"),data:params,cache:!1,responseType:'json'})};factory.findAllCustomerFeed=function(customer_id){var params={customer_id:customer_id};return $sbhttp({method:'GET',url:Url.get("phonebook/mobile_view/find-all-customer-feed",params),cache:!1,responseType:'json'})};factory.FollowingNow=function(friend_id){var params={friend_id:friend_id,value_id:factory.value_id};return $sbhttp({method:'GET',url:Url.get("phonebook/mobile_view/following",params),cache:!1,responseType:'json'})};factory.FollowingCancel=function(id){var params={id:id,};return $sbhttp({method:'GET',url:Url.get("phonebook/mobile_view/following-cancel",params),cache:!1,responseType:'json'})};factory.customerFollowers=function(friend_id){var params={friend_id:friend_id,};return $sbhttp({method:'GET',url:Url.get("phonebook/mobile_view/get-following-follower",params),cache:!1,responseType:'json'})};factory.deleteGallery=function(id,friend_id){var params={id:id,friend_id:friend_id};return $sbhttp({method:'GET',url:Url.get("phonebook/mobile_view/delete-gallery-photo",params),cache:!1,responseType:'json'})};return factory});angular.module('starter').controller('PhonebookHomeController',function(Application,$location,$anchorScroll,SB,$state,$scope,$rootScope,$translate,Phonebook,Customer,Loader,Dialog,$stateParams,$ionicScrollDelegate,$timeout){$scope.value_id=Phonebook.value_id=$stateParams.value_id;Phonebook.searchText=null;$scope.page_title="Phonebook";$scope.customer_is_logged_in=!1;$scope.my_avatar_url='';$scope.is_loading=!0;$scope.can_load_older_posts=!0;$scope.collection=$scope.repeaterObject=$scope.customer=[];$scope.AtoZ=['#','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];$scope.app_name=Application.app_name;$scope.phonebook_settings={};$scope.unread_message_count=0;$scope.selected_alphabat=null;$scope.use_pull_refresh=!0;$scope.pull_to_refresh=!1;$scope.customerInfo=function(){if(Customer.isLoggedIn()){$scope.customer=Customer.customer;$scope.my_avatar_url=Customer.getAvatarUrl(Customer.id);$scope.customer_is_logged_in=!0}};$scope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.is_logged_in=!0;$scope.customerInfo();$scope.loadSettings()});$scope.loadSettings=function(){Phonebook.getSetings().then(function(payload){$scope.phonebook_settings=payload.setings;Phonebook.setSettings(payload.setings)},function(error){Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){})};$scope.pullToRefresh=function(){$scope.pull_to_refresh=!0;$scope.loadCustomers();Phonebook.filterText=null}
$scope.loadCustomers=function(){$scope.collection=[];$scope.selected_alphabat=Phonebook.filterText;$scope.is_loading=!0;if($scope.selected_alphabat==null){Loader.show()}
Phonebook.findAll($scope.collection.length,null,$scope.selected_alphabat).success(function(data){$scope.page_title=data.page_title;$scope.unread_message_count=data.unread_count;$scope.can_load_older_posts=!!data.collection.length;$scope.collection=$scope.collection.concat(data.collection);$scope.collection.sort(function(a,b){if(a.firstname.toUpperCase()<b.firstname.toUpperCase())return-1;if(a.firstname.toUpperCase()>b.firstname.toUpperCase())return 1;return 0});var tmp={};for(var i=0;i<$scope.collection.length;i++){var cn=$scope.collection[i].firstname.toUpperCase();var letter=cn.charAt(0);if(tmp[letter]==undefined){tmp[letter]=[]}
tmp[letter].push($scope.collection[i])}
$scope.repeaterObject=tmp;$timeout(function(){$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop()},300);Loader.hide();$rootScope.$broadcast("refreshPageSize")}).error(function(){Loader.hide();$scope.can_load_older_posts=!1;$scope.is_loading=!1}).finally(function(){$scope.is_loading=!1;if($scope.pull_to_refresh){$scope.$broadcast('scroll.refreshComplete');$scope.pull_to_refresh=!1}
$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.backgroundCustomersCall=function(){Phonebook.findAll($scope.collection.length,null,$scope.selected_alphabat).success(function(data){$scope.page_title=data.page_title;$scope.unread_message_count=data.unread_count;$scope.can_load_older_posts=!!data.collection.length;$scope.collection=$scope.collection.concat(data.collection);Phonebook.setCustomers($scope.collection);$scope.collection.sort(function(a,b){if(a.firstname.toUpperCase()<b.firstname.toUpperCase())return-1;if(a.firstname.toUpperCase()>b.firstname.toUpperCase())return 1;return 0});var tmp={};for(var i=0;i<$scope.collection.length;i++){var cn=$scope.collection[i].firstname.toUpperCase();var letter=cn.charAt(0);if(tmp[letter]==undefined){tmp[letter]=[]}
tmp[letter].push($scope.collection[i])}
$scope.repeaterObject=tmp;$rootScope.$broadcast("refreshPageSize")}).error(function(){$scope.can_load_older_posts=!1}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$scope.listByAlphabet=function(alphabat){Phonebook.filterText=alphabat;if(alphabat=="#"){Phonebook.filterText=null}
$scope.loadCustomers()};$scope.seachContactModal=function(){$state.go("phonebook-search",{value_id:$scope.value_id})};$scope.$on('$ionicView.enter',function(scopes,states){$scope.customerInfo();$scope.loadSettings();$scope.loadCustomers()});$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/phonebook/assets/templates/images/customer-placeholder.png"}};$scope.forTranslate=function(text){return $translate.instant(text,"phonebook")}});angular.module('starter').controller('PhonebookInviteController',function($window,$state,$scope,$rootScope,$timeout,$translate,$ionicSideMenuDelegate,Modal,Phonebook,Customer,Loader,ContextualMenu,Dialog,SB,$stateParams){});angular.module('starter').controller('PhonebookInfoController',function($window,$state,$scope,$rootScope,$timeout,$translate,$filter,$ionicModal,Phonebook,Customer,Loader,Dialog,SB,$stateParams,$cordovaCamera,$ionicActionSheet,$ionicScrollDelegate,Application,$ionicPopup){$scope.value_id=Phonebook.value_id=$stateParams.value_id;$scope.friend_id=$stateParams.friend_id;$scope.pageTitle="Phonebook";$scope.isLoading=!0;$scope.my_avatar_url='';$scope.app_name=Application.app_name;$scope.is_loggedIn_customers=!1;$scope.phonebook_settings={};$scope.privacysettings={};$scope.setfrequently=function(){if(Customer.isLoggedIn()){$scope.isLoading=!0;Phonebook.setfrequently($scope.friend_id).then(function(payload){$scope.payload=payload},function(error){Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){$scope.isLoading=!1;Loader.hide()})}}
$scope.customerInfo=function(){Loader.show();$scope.isLoading=!0;Phonebook.customerInfo($scope.friend_id).then(function(payload){$scope.customer_info=payload;$scope.following_status=$scope.customer_info.followerValues;$scope.gallery_images=$scope.customer_info.galleryphotos;$scope.imageGalleryImages=$scope.customer_info.imageGalleryImages;$scope.privacysettings=$scope.customer_info.privacysettings;$scope.gallery_basePath=IMAGE_URL+'images/application';$scope.image_gallery_basePath=IMAGE_URL+'images/application/features/imagegallery/original/';if(Customer.isLoggedIn()&&Customer.id==$scope.customer_info.customer.id){$scope.is_loggedIn_customers=!0}
if($scope.customer_info.info&&angular.isObject($scope.customer_info.info)&&!$scope.isUndefined($scope.customer_info.info.cover_photo)&&$scope.customer_info.info.cover_photo!=null){$scope.cover_url=IMAGE_URL+'images/application'+$scope.customer_info.info.cover_photo}else{$scope.cover_url="./features/phonebook/assets/templates/images/default_cover.jpg"}},function(error){$scope.isLoading=!1;Loader.hide();Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){$scope.isLoading=!1;Loader.hide()})}
$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/phonebook/assets/templates/images/customer-placeholder.png"}};$scope.loadSettings=function(){Phonebook.getSetings().then(function(payload){$scope.phonebook_settings=payload.setings;Phonebook.setSettings(payload.setings)},function(error){Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){})};$scope.$on('$ionicView.enter',function(){$scope.phonebook_settings=Phonebook.getSettings();if(Object.keys($scope.phonebook_settings).length===0){$scope.loadSettings()}
$scope.setfrequently();$scope.customerInfo()});$scope.takeCoverPicture=function(field){var gotImage=function(image_url){$scope.cropModal={original:image_url,result:null};$scope.popupShowing=!1;$ionicPopup.show({template:'<div style="position: absolute" class="cropper">'+'<img-crop ng-if="popupShowing" image="cropModal.original" result-image="cropModal.result" area-type="square" result-image-size="256" result-image-format="image/jpeg" result-image-quality="0.9"></img-crop>'+'</div>',cssClass:'avatar-crop',scope:$scope,buttons:[{text:$translate.instant('Cancel'),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK'),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.cropModalCtrl=null;$scope.cover_url=$scope.cropModal.result;Loader.show('Uploading');Phonebook.SaveCoverPhoto($scope.cover_url).then(function(payload){Dialog.alert($translate.instant('Success','phonebook'),$translate.instant('Cover photo changed successfully!','phonebook'),$translate.instant('OK','phonebook'),-1,"phonebook")},function(error){Dialog.alert($translate.instant('Error','phonebook'),error.message,$translate.instant('OK','phonebook'),-1,"phonebook")}).then(function(){$scope.isLoading=!1;Loader.hide()})}});$scope.popupShowing=!0};var gotError=function(err){Dialog.alert("Error",err.message,"OK",-1,"phonebook")};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(onloadEvt){gotImage(onloadEvt.target.result);input.off('change',selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on('change',selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant('Take a picture')},{text:$translate.instant('Import from Library')}],cancelText:$translate.instant('Cancel'),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:340,targetHeight:200,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage('data:image/jpeg;base64,'+imageData)},gotError);return!0}})}};$scope.isUndefined=function(thing){return(typeof thing==="undefined")}
$scope.editInfo=function(){$ionicModal.fromTemplateUrl('features/phonebook/assets/templates/l1/modal/edit.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.user=$scope.customer_info.info;if(!$scope.user){$scope.user={about_me:'',mobile_number:'',date_of_brith:''}}
if($scope.user&&!$scope.isUndefined($scope.user.date_of_brith)){$scope.user.date_of_brith=new Date($scope.user.date_of_brith)}
$scope.editModal=modal;$scope.editModal.show()})};$scope.SaveCustomerProfile=function(){Loader.show();Phonebook.SaveCustomerProfile($scope.user).then(function(payload){Dialog.alert($translate.instant('Success','phonebook'),$translate.instant('Info updated successfully!','phonebook'),$translate.instant('OK','phonebook'),-1,"phonebook")},function(error){Dialog.alert($translate.instant('Error','phonebook'),error.message,$translate.instant('OK','phonebook'),-1,"phonebook")}).then(function(){$scope.isLoading=!1;Loader.hide();$scope.editModal.hide()})}
$scope.close=function(){$scope.editModal.hide()}
$scope.findAllCustomerFeed=function(){Loader.show();$ionicModal.fromTemplateUrl('features/phonebook/assets/templates/l1/modal/feed.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){Phonebook.findAllCustomerFeed($scope.friend_id).then(function(payload){$scope.customerFeeds=payload.data.collection;$scope.feed_basePath=IMAGE_URL+'images/application'},function(error){Dialog.alert($translate.instant('Error','phonebook'),error.message,$translate.instant('OK','phonebook'),-1,"phonebook")}).then(function(){Loader.hide()});$scope.feedModal=modal;$scope.feedModal.show()})};$scope.closeFeed=function(){$scope.feedModal.hide()}
$scope.customerFollowModal=function(follower_following_active){$scope.isLoading=!0;$scope.follower_following_active=follower_following_active;Loader.show();$ionicModal.fromTemplateUrl('features/phonebook/assets/templates/l1/modal/follow-list.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){Phonebook.customerFollowers($scope.friend_id).then(function(payload){$scope.follow_list=payload.data},function(error){$scope.isLoading=!1;Dialog.alert($translate.instant('Error','phonebook'),error.message,$translate.instant('OK','phonebook'),-1,"phonebook")}).then(function(){$scope.isLoading=!1;Loader.hide()});$scope.followModal=modal;$scope.followModal.show()})};$scope.closeFollow=function(){$scope.followModal.hide()}
$scope.publicationDate=function(date){return $filter("moment_calendar")(date*1000)};$scope.dobDate=function(date){return $filter('date')(date,"dd-MM-yyyy")};$scope.addGalleryPhoto=function(field){var gotImage=function(image_url){$scope.cropModal={original:image_url,result:null};$scope.popupShowing=!1;$ionicPopup.show({template:'<div style="position: absolute" class="cropper">'+'<img-crop ng-if="popupShowing" image="cropModal.original" result-image="cropModal.result" area-type="square" result-image-size="256" result-image-format="image/jpeg" result-image-quality="0.9"></img-crop>'+'</div>',cssClass:'avatar-crop',scope:$scope,buttons:[{text:$translate.instant('Cancel'),type:'button-default',onTap:function(e){return!1}},{text:$translate.instant('OK'),type:'button-positive',onTap:function(e){return!0}}]}).then(function(result){if(result){$scope.cropModalCtrl=null;Loader.show('Uploading');Phonebook.addGalleryPhoto($scope.cropModal.result).then(function(payload){$scope.gallery_images=payload.data.galleryphotos;Dialog.alert($translate.instant('Success','phonebook'),$translate.instant('Photo uploaded successfully!','phonebook'),$translate.instant('OK','phonebook'),-1,"phonebook")},function(error){Dialog.alert($translate.instant('Error','phonebook'),error.message,$translate.instant('OK','phonebook'),-1,"phonebook")}).then(function(){$scope.isLoading=!1;Loader.hide()})}});$scope.popupShowing=!0};var gotError=function(err){Dialog.alert("Error",err.message,"OK",-1,"phonebook")};if(Application.is_webview){var input=angular.element("<input type='file' accept='image/*'>");var selectedFile=function(evt){var file=evt.currentTarget.files[0];var reader=new FileReader();reader.onload=function(onloadEvt){gotImage(onloadEvt.target.result);input.off('change',selectedFile)};reader.onerror=gotError;reader.readAsDataURL(file)};input.on('change',selectedFile);input[0].click()}else{var source_type=Camera.PictureSourceType.CAMERA;var hideSheet=$ionicActionSheet.show({buttons:[{text:$translate.instant('Take a picture')},{text:$translate.instant('Import from Library')}],cancelText:$translate.instant('Cancel'),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){source_type=Camera.PictureSourceType.CAMERA}
if(index==1){source_type=Camera.PictureSourceType.PHOTOLIBRARY}
var options={quality:90,destinationType:Camera.DestinationType.DATA_URL,sourceType:source_type,encodingType:Camera.EncodingType.JPEG,targetWidth:360,targetHeight:117,correctOrientation:!0,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1};$cordovaCamera.getPicture(options).then(function(imageData){gotImage('data:image/jpeg;base64,'+imageData)},gotError);return!0}})}};$scope.loginModal=function(){Customer.loginModal($scope)}
$scope.FollowingNow=function(){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
$scope.is_submitting=!0;Phonebook.FollowingNow($scope.friend_id).then(function(payload){$scope.following_status=payload.data.followerValues;$rootScope.$broadcast("refreshPageSize")},function(error){$scope.is_submitting=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){$scope.is_submitting=!1})}
$scope.FollowingCancel=function(id){$scope.is_submitting=!0;Phonebook.FollowingCancel(id).then(function(payload){$scope.following_status=payload.data.followerValues;$rootScope.$broadcast("refreshPageSize")},function(error){$scope.is_submitting=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){$scope.is_submitting=!1})}
$scope.deleteGallery=function(id){$scope.is_submitting=!0;Phonebook.deleteGallery(id,$scope.friend_id).then(function(payload){$scope.gallery_images=payload.data.galleryphotos},function(error){$scope.is_submitting=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){$scope.is_submitting=!1})}
$scope.displayPersonalInfo=function(is_loggedIn_customers,following_status){if(is_loggedIn_customers){return!0}else{return following_status>=0?!0:!1}}
$scope.forTranslate=function(text){return $translate.instant(text,"phonebook")};$scope.customerMessage=function(){Loader.show();$scope.is_loading=!0;$scope.messages=[];$scope.sentmessages=[];$ionicModal.fromTemplateUrl('features/phonebook/assets/templates/l1/modal/message.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.sentmessages.sender_id=Customer.id;$scope.sentmessages.receiver_id=$scope.friend_id;$scope.sentmessages.message='';$scope.messages_page_title=$scope.customer_info.customer.firstname;$scope.messagesModal=modal;$scope.messagesModal.show();$timeout(function(){Phonebook.findAllMessages($scope.sentmessages).success(function(payload){$scope.messages=payload.messages;$scope.is_loading=!1;$scope._scrollBottom();Loader.hide()},function(error){Dialog.alert("Error",error.message,"OK",-1,"phonebook");Loader.hide()})},300)})};$scope.closeMessagesModal=function(){$scope.messagesModal.remove()}
$scope.sendMessage=function(){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
if($scope.sentmessages.message==''){Dialog.alert("Validation Error","Please enter a messages!","OK",-1,"phonebook")}else{$scope.sending_message=!0;Phonebook.saveMessage($scope.sentmessages).success(function(data){$scope.messages=data.messages;$scope._scrollBottom();$scope.sentmessages.message='';$scope.sending_message=!1}).error(function(error){Dialog.alert($translate.instant("Error","phonebook"),error.message,"OK",-1,"phonebook");$scope.sending_message=!1})}}
$scope._scrollBottom=function(){$timeout(function(){$ionicScrollDelegate.$getByHandle('messageScroll').scrollBottom(!0)},500)};$scope.convertMessageDate=function(date){return $filter("moment_calendar")((new Date(date)).getTime())};$scope.privacySettings=function(){$scope.settings=$scope.privacysettings;Loader.show();$ionicModal.fromTemplateUrl('features/phonebook/assets/templates/l1/modal/settings.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.settings=$scope.privacysettings;Loader.hide();$scope.privacySettingsModal=modal;$scope.privacySettingsModal.show()})};$scope.closePrivacySettings=function(){$scope.privacySettingsModal.hide()}
$scope.saveSettings=function(){Phonebook.saveSettings($scope.settings,Customer.id).success(function(data){Dialog.alert($translate.instant("Success","phonebook"),$translate.instant("Settings updated successfully","phonebook"),"OK",-1,"phonebook")}).error(function(error){Dialog.alert($translate.instant("Error","phonebook"),error.message,"OK",-1,"phonebook")})}});angular.module('starter').controller('PhonebookSearchController',function($window,$state,$scope,$rootScope,$timeout,$translate,$ionicSideMenuDelegate,Modal,Phonebook,Customer,Loader,$filter,Dialog,SB,$stateParams){$scope.value_id=Phonebook.value_id=$stateParams.value_id;$scope.search_collection=new Array();$scope.is_loading=!1;$scope.recent_customers=Phonebook.getRecentCustomers();$scope.myObj={search:""};$scope.displayed_per_page=100;$scope.searchPhoneDirectory=function(){$scope.is_loading=!0;$scope.search_collection=new Array();Phonebook.searchText=$scope.myObj.search;Phonebook.findAll($scope.search_collection.length,$scope.myObj.search).success(function(data){$scope.search_collection=new Array();$scope.displayed_per_page=data.displayed_per_page;$scope.can_load_older_posts=!!data.collection.length;$scope.search_collection=$scope.search_collection.concat(data.collection);$scope.search_collection.sort(function(a,b){if(a.firstname.toUpperCase()<b.firstname.toUpperCase())return-1;if(a.firstname.toUpperCase()>b.firstname.toUpperCase())return 1;return 0});var tmp={};for(var i=0;i<$scope.search_collection.length;i++){var cn=$scope.search_collection[i].firstname.toUpperCase();var letter=cn.charAt(0);if(tmp[letter]==undefined){tmp[letter]=[]}
tmp[letter].push($scope.search_collection[i])}
$scope.repeaterObject=tmp;$rootScope.$broadcast("refreshPageSize")}).error(function(){$scope.search_collection=new Array();$scope.can_load_older_posts=!1;$scope.is_loading=!1}).finally(function(){$scope.is_loading=!1;$scope.$broadcast('scroll.infiniteScrollComplete')})}
$scope.backgroundCustomersCall=function(){if($scope.displayed_per_page<$scope.search_collection.length){$scope.can_load_older_posts=!1;return!1}
Phonebook.findAll($scope.search_collection.length,$scope.myObj.search).success(function(data){$scope.can_load_older_posts=!!data.collection.length;$scope.search_collection=$scope.search_collection.concat(data.collection);$scope.search_collection.sort(function(a,b){if(a.firstname.toUpperCase()<b.firstname.toUpperCase())return-1;if(a.firstname.toUpperCase()>b.firstname.toUpperCase())return 1;return 0});var tmp={};for(var i=0;i<$scope.search_collection.length;i++){var cn=$scope.search_collection[i].firstname.toUpperCase();var letter=cn.charAt(0);if(tmp[letter]==undefined){tmp[letter]=[]}
tmp[letter].push($scope.search_collection[i])}
$scope.repeaterObject=tmp;$rootScope.$broadcast("refreshPageSize")}).error(function(){$scope.can_load_older_posts=!1}).finally(function(){$scope.$broadcast('scroll.infiniteScrollComplete')})};$rootScope.$on('$ionicView.beforeEnter',function(){if(Phonebook.searchText){$scope.myObj.search=Phonebook.searchText;$scope.searchPhoneDirectory()}});$scope.customer_avatar=function(image){if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/phonebook/assets/templates/images/customer-placeholder.png"}};$scope.close=function(){$state.go("phonebook-home",{value_id:$scope.value_id})}
$scope.setRecentinfo=function(friend_id){$scope.visited_customer=$filter('filter')(Phonebook.getCustomers(),{customer_id:friend_id});if($scope.visited_customer){Phonebook.setRecentCustomers($scope.visited_customer[0])}}
$scope.authFocus=function(){$timeout(function(){document.getElementById("contactSearch").focus()},300)}
$scope.authFocus();$scope.forTranslate=function(text){return $translate.instant(text,"phonebook")}});angular.module('starter').controller('PhonebookMessagesController',function($window,$state,$scope,$rootScope,$timeout,$translate,$filter,$ionicModal,Phonebook,Customer,Loader,Dialog,SB,$stateParams,$ionicActionSheet,Application,$ionicPopup){$scope.value_id=Phonebook.value_id=$stateParams.value_id;$scope.customer_id=Customer.id;$scope.is_loading=!1;$scope.loadContent=function(){$scope.is_loading=!0;Phonebook.findInbox().then(function(payload){$scope.rooms=payload.rooms},function(error){$scope.is_loading=!1;Dialog.alert("Error",error.message,"OK",-1,"phonebook")}).then(function(){$scope.is_loading=!1})}
$scope.loadContent();$scope.customer_avatar=function(values){var image=values.receiver_image;if(values.receiver_customer_id==Customer.id){image=values.sender_image}
if(image!=''&&image!=null&&image!="null"){return IMAGE_URL+'images/customer'+image}else{return"./features/phonebook/assets/templates/images/customer-placeholder.png"}};$scope.customer_name=function(values){var customername=values.receiver_first_name+' '+values.receiver_last_name;if(values.receiver_customer_id==Customer.id){customername=values.sender_first_name+' '+values.sender_last_name}
return customername};$scope.customer_id=function(values){var id=values.receiver_customer_id;if(values.receiver_customer_id==Customer.id){id=values.sender_customer_id}
return id};$scope.convertMessageDate=function(date){return $filter("moment_calendar")((new Date(date)).getTime())};$scope.forTranslate=function(text){return $translate.instant(text,"phonebook")}}).controller('PhonebookMessagesViewController',function($window,$state,$scope,$rootScope,$timeout,$translate,$filter,$ionicModal,Phonebook,Customer,$ionicScrollDelegate,Loader,Dialog,SB,$stateParams,$ionicActionSheet,Application,$ionicPopup){$scope.value_id=Phonebook.value_id=$stateParams.value_id;$scope.friend_id=$stateParams.friend_id;$scope.is_loading=!1;$scope.sentmessages=[];$scope.messages=[];$scope.sentmessages.sender_id=Customer.id;$scope.sentmessages.receiver_id=$scope.friend_id;$scope.flags={};$scope.loadContent=function(){Loader.show();$scope.is_loading=!0;Phonebook.findAllMessages($scope.sentmessages).success(function(payload){$scope.sentmessages.message='';$scope.messages_page_title=payload.customer_info.firstname;$scope.messages=payload.messages;$scope.is_loading=!1;$scope._scrollBottom();Loader.hide()},function(error){Dialog.alert("Error",error.message,"OK",-1,"phonebook");Loader.hide()})}
$scope.loadContent();$scope.sendMessage=function(){if(!Customer.isLoggedIn()){return Customer.loginModal($scope)}
if($scope.sentmessages.message==''){Dialog.alert($translate.instant("Validation Error","phonebook"),$translate.instant("Please enter a messages!","phonebook"),"OK",-1,"phonebook")}else{$scope.sending_message=!0;Phonebook.saveMessage($scope.sentmessages).success(function(data){$scope.messages.push(data.messages);$scope._scrollBottom();$scope.sentmessages.message='';$scope.sending_message=!1}).error(function(error){Dialog.alert($translate.instant("Error","phonebook"),error.message,"OK",-1,"phonebook");$scope.sending_message=!1})}}
$scope._scrollBottom=function(){$timeout(function(){$ionicScrollDelegate.$getByHandle('messageScroll').scrollBottom(!0)},500)};$scope.convertMessageDate=function(date){return $filter("moment_calendar")((new Date(date)).getTime())};$scope.forTranslate=function(text){return $translate.instant(text,"phonebook")};$scope.displayMessage=function(message){if(Customer.id==message.sender_id){return message.sender_delete==0?!0:!1}else{return message.receiver_delete==0?!0:!1}};$scope.displaySenderDeleteMessage=function(message){if(Customer.id==message.receiver_delete_by){return message.receiver_delete==1?!0:!1}
if(Customer.id==message.sender_id){return message.sender_delete==1?!0:!1}};$scope.displayReceiverDeleteMessage=function(message){if(Customer.id==message.receiver_id){if(Customer.id==message.receiver_delete_by){return message.receiver_delete==1?!1:!0}
return message.receiver_delete==1?!0:!1}};$scope.deleteOption=function(messageId,sender_id,key){var OptionButton=[];if(sender_id==Customer.id){OptionButton=[{text:$translate.instant('Delete for Me',"phonebook")},{text:$translate.instant('Delete for Everyone',"phonebook")}]}else{OptionButton=[{text:$translate.instant('Delete for Me',"phonebook")}]}
var hideSheet=$ionicActionSheet.show({buttons:OptionButton,cancelText:$translate.instant('Cancel',"phonebook"),cancel:function(){hideSheet()},buttonClicked:function(index){if(index==0){Loader.show();Phonebook.deleteMessage(messageId,1).success(function(data){$scope.messages[key].sender_delete=1;$scope.messages[key].receiver_delete=1;$scope.messages[key].receiver_delete_by=Customer.id;Loader.hide()}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","phonebook"),error.message,"OK",-1,"phonebook")})}
if(index==1){Loader.show();Phonebook.deleteMessage(messageId,2).success(function(data){$scope.messages[key].sender_delete=1;$scope.messages[key].receiver_delete=1;$scope.messages[key].receiver_delete=Customer.id;Loader.hide()}).error(function(error){Loader.hide();Dialog.alert($translate.instant("Error","phonebook"),error.message,"OK",-1,"phonebook")})}
return!0}})}});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.phonebook .phonebook-profile-image>img{top:0px!important;max-width:80px!important;max-height:80px!important;border:5px solid #fff}.phonebook .phonebook-cover-image{min-height:123px!important;border:0}.phonebook .phonebook-profile-name{color:#fff!important;font-size:21px!important;margin-left:15%!important;font-weight:600!important}.phonebook .phonebook-about-me{margin-left:15%!important;font-size:18px!important}.phonebook .phonebook-social-count{position:inherit!important;border:transparent!important;background-image:none!important}.phonebook .phonebook-social-box{border-width:0px!important;border-bottom:0 solid #9e9e9e!important;box-shadow:0 0 #888}.phonebook .phonebook-social-count-values{font-size:24px!important}.phonebook .about-me-div .ion-compose{font-size:20px}.phonebook .photo-upload .ion-plus{font-size:20px}.phonebook .phonebook-feed-date{font-size:12px;text-align:right}.phonebook .item.follow-item{border:0;margin-top:0;padding-top:0}.phonebook button.follow-button{line-height:26px;min-height:30px;min-width:100%}.phonebook button.message-button{line-height:26px;min-height:30px;min-width:100%;margin:0 10px}.phonebook .follower-content{margin-top:10%}.phonebook p.delete-gallery{margin-top:-24px;text-align:center;background-color:rgba(0,0,0,.5);position:relative;color:#fff}.phonebook .phonebook-message-item p{margin:0}.phonebook .phonebook-messages a.subdued{opacity:.5;padding-left:0}.phonebook .phonebook-list span.badge-message{margin-top:-15px;margin-right:10px}.phonebook p.deleted-message{opacity:.5}","phonebook")