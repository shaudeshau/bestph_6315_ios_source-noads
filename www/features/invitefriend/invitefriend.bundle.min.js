angular.module('starter').controller('InviteFriendViewController',function($rootScope,$scope,$stateParams,Customer,SB,Dialog,SocialSharing,Modal,Invitefriend,Loader,$state,$translate){$scope.value_id=Invitefriend.value_id=$stateParams.value_id;$scope.is_logged_in=Customer.isLoggedIn();$scope.referCode="";$scope.page_title="";$scope.content=[];$scope.settings=[];$scope.shareURL='';$scope.coverImageURL='';$scope.is_loading=!1;$scope.sharing_data='';$scope.is_used_coupon=0;$scope.inviteEmail=[];$scope.inviteEmail.email='';$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$scope.loadContent()});$scope.$on('$ionicView.beforeEnter',function(){$scope.loadContent()});$scope.login=function(){Customer.loginModal($scope)}
$scope.loadContent=function(){$scope.is_logged_in=!1;if(Customer.isLoggedIn()){Loader.show();$scope.is_loading=!0;$scope.is_logged_in=!0;$scope.customer_id=Customer.id;Invitefriend.find($scope.customer_id).then(function(data){Loader.hide();$scope.is_loading=!1;$scope.referCode=data.referCode;$scope.page_title=data.page_title;$scope.content=data.content;$scope.settings=data.settings;$scope.shareURL=data.shareURL;$scope.coverImageURL=data.coverImageURL;$scope.sharing_data=data.sharing_data;$scope.is_used_coupon=data.is_used_coupon},function(error){$scope.is_loading=!1;Loader.hide();Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),-1)}).then(function(){$scope.is_loading=!1;Loader.hide()})}};$scope.shareSocial=function(tools){if(!$rootScope.isNativeApp){Dialog.alert($translate.instant("Error"),$translate.instant("This feature is disable on webview!"),$translate.instant("Dismiss"),2350);return!0}
if($scope.sharing_data==''){Dialog.alert($translate.instant("Error"),$translate.instant("Something went wrong, Please try again later!"),$translate.instant("Dismiss"),2350);return!0}
switch(tools){default:return window.plugins.socialsharing.share($scope.sharing_data);break;case "whatsapp":return window.plugins.socialsharing.shareViaWhatsApp($scope.sharing_data);break;case "facebook":return window.plugins.socialsharing.shareViaFacebook($scope.sharing_data);break;case "twitter":return window.plugins.socialsharing.shareViaTwitter($scope.sharing_data);break;case "instagram":return window.plugins.socialsharing.shareViaInstagram($scope.sharing_data);break;case "sms":return window.plugins.socialsharing.shareViaSMS($scope.sharing_data)}};$scope.ApplyCodeModal=function(){Modal.fromTemplateUrl('features/invitefriend/assets/templates/l2/modal/code.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){$scope.content=$scope.content;$scope.codeModal=modal;$scope.codeModal.show()})};$scope.closeCodeModal=function(){$scope.codeModal.hide()};$scope.verifyCode=function(inputCode){if(inputCode==$scope.referCode){Dialog.alert($translate.instant("Error"),$translate.instant("Please enter a valid code!"),"OK",2350,"invitefriend");return!0}
Loader.show();Invitefriend.verifyCode(inputCode,$scope.content.id).success(function(data){Dialog.alert($translate.instant("Success"),$translate.instant(data.message),$translate.instant("OK"),2350,"invitefriend");$scope.closeCodeModal();Loader.hide();$state.go("invitefriend_view",{value_id:$scope.value_id},{reload:!0})}).error(function(error){Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),2350,"invitefriend");Loader.hide()}).finally(function(){})};$scope.sendByEmail=function(){Loader.show();Invitefriend.inviteByEmail($scope.inviteEmail.email,$scope.content.id).success(function(data){Dialog.alert($translate.instant("Success"),$translate.instant("Invitation successfully sent!"),$translate.instant("OK"),2350,"invitefriend");$scope.inviteEmail.email='';Loader.hide()}).error(function(error){Dialog.alert($translate.instant("Error"),error.message,$translate.instant("OK"),2350,"invitefriend");Loader.hide()}).finally(function(){})};$scope.fulltextDetails=function(code){Modal.fromTemplateUrl('features/invitefriend/assets/templates/l2/modal/fulltext.html',{scope:$scope,animation:'slide-in-up'}).then(function(modal){if(code=='tc'){$scope.fulltext_title=$translate.instant("Term & Conditions");$scope.fulltext_body=$scope.settings.term_conditions}
if(code=='hw'){$scope.fulltext_title=$translate.instant("How It Works");$scope.fulltext_body=$scope.settings.how_its_work}
$scope.fulltextModal=modal;$scope.fulltextModal.show()})};$scope.closeFulltextModal=function(){$scope.fulltextModal.hide()}});angular.module('starter').factory('Invitefriend',function($pwaRequest){var factory={};factory.value_id=null;factory.setValueId=function(valueId){factory.value_id=valueId};factory.find=function(customer_id){if(!factory.value_id){return $pwaRequest.reject('Invitefriend::find missing value_id.')}
return $pwaRequest.get('invitefriend/mobile_view/findv2',{urlParams:{value_id:factory.value_id,customer_id:customer_id},cache:!1})};factory.sendCode=function(code,customer_id,plc_points){return $pwaRequest.post('invitefriend/mobile_view/sendcode',{urlParams:{value_id:this.value_id},data:{code:code,customer_id:customer_id,plc_points:plc_points},cache:!1})};factory.inviteByEmail=function(emailId,invite_id){return $pwaRequest.post('invitefriend/mobile_view/send-email-invitation',{data:{value_id:this.value_id,email:emailId,invite_id:invite_id},cache:!1})};factory.verifyCode=function(inputCode,invite_id){return $pwaRequest.post('invitefriend/mobile_view/verify-code',{data:{value_id:this.value_id,input_code:inputCode,invite_id:invite_id},cache:!1})};return factory});Features.insertCSS(":root{--safe-area-inset-top:0;--safe-area-inset-right:0;--safe-area-inset-bottom:0;--safe-area-inset-left:0}@supports (padding-top:constant(safe-area-inset-top)){:root{--safe-area-inset-top:constant(safe-area-inset-top);--safe-area-inset-right:constant(safe-area-inset-right);--safe-area-inset-bottom:constant(safe-area-inset-bottom);--safe-area-inset-left:constant(safe-area-inset-left)}}@supports (padding-top:env(safe-area-inset-top)){:root{--safe-area-inset-top:env(safe-area-inset-top);--safe-area-inset-right:env(safe-area-inset-right);--safe-area-inset-bottom:env(safe-area-inset-bottom);--safe-area-inset-left:env(safe-area-inset-left)}}.platform-overview.platform-cordova{--safe-area-inset-top:1.5em;--safe-area-inset-right:0;--safe-area-inset-bottom:.5em;--safe-area-inset-left:0}.invitefriend-module .img_size{width:100%}.invitefriend-module .ion-ios-plus-outline:before{font-size:50px;color:#6a9d50;font-weight:700}.invitefriend-module .friend_code{padding:5px;border:1px solid #6a9d50;width:100%;margin:0 auto;border-radius:10px}.invitefriend-module .share_icon{text-align:center;max-width:240px;margin:0 auto;width:100%;background:#6a9d50;padding:10px 0;color:#fff;border-bottom-left-radius:6px;border-top-left-radius:6px}.invitefriend-module .share_icon .share_text{display:inline-block;vertical-align:middle;width:135px;text-transform:uppercase;font-size:22px}.invitefriend-module .share_icon .ion-android-share-alt{display:inline-block;vertical-align:middle;width:60px;float:right;height:60px;line-height:60px;background:#6a9d50;position:absolute;top:7px;border-radius:50%;font-size:36px}.invitefriend-module .box_shadow{box-shadow:none}.invitefriend-module .background_none{background:none;border:0}.invitefriend-module .description h1,.invitefriend-module .description h2,.invitefriend-module .description h3{margin:0 0 20px;font-size:24px;font-weight:700}.invitefriend-module .description p{color:#000;font-size:18px;line-height:1.3}.invitefriend-module .add_code{line-height:2}.invitefriend-module .item.item-input-inset.share_with_input{max-width:280px;margin:0 auto}.invitefriend-module .share_with_input label input{background:#fff!important;vertical-align:middle;height:35px!important;width:100%!important;border:1px solid #6a9d50}.invitefriend-module .ion-share{font-size:75px;color:#6a9d50;vertical-align:middle;display:inline-block}.invitefriend-module .invite-frnd-div .item.item-body h2{margin:0 0 20px;font-size:24px;font-weight:700}.invitefriend-module .invite-frnd-div .item.item-body p{color:#000;font-size:18px;line-height:1.3}.invitefriend-module .invite-frnd-div .item.item-body{padding:30px}.invitefriend .item{border:none}.invitefriend .termandconditions{text-align:center}.invitefriend .refer-code-box{text-align:center}.invitefriend h2.title{text-align:center}.invitefriend .refer-code span.icon-active-custom{border:1px dotted;padding:5px 30px}.invitefriend .apply-code-box{text-align:center}.invitefriend button.social-icon.ion-social-facebook-outline{color:#fff;background-color:#3f51b5;min-width:52px}.invitefriend button.social-icon.ion-social-whatsapp-outline{color:#fff;background-color:#4caf50;min-width:52px}.invitefriend button.social-icon.ion-social-twitter-outline{color:#fff;background-color:#2196f3;min-width:52px}.invitefriend button.social-icon.ion-social-instagram-outline{color:#fff;background-color:#e91e63;min-width:52px}.invitefriend button.social-icon.ion-ios-email-outline{color:#fff;background-color:#009688;min-width:52px}.invitefriend button.social-icon.ion-more{color:#fff;background-color:#9e9e9e;min-width:52px}.invitefriend .or-divider{padding:0}.invitefriend p.orline{margin-top:0}.invitefriend .apply-code-box{padding:5px}","invitefriend")