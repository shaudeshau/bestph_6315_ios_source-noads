window.momentjs_loaded=!1,window.extractI18n=!0;var DEBUG=!1;if(void 0===LOGIN_FB)var LOGIN_FB=!1;if(void 0===IS_PREVIEW)var IS_PREVIEW=!1;var isNativeApp=IS_NATIVE_APP,isOverview=-1!==window.location.href.indexOf("/apps/overview/"),lazyLoadResolver=function(code){return{lazy:["$q","$timeout","$ocLazyLoad",function($q,$timeout,$ocLazyLoad){var localCode=angular.copy(code);angular.isArray(localCode)||(localCode=[localCode]);var files=[];localCode.forEach(function(file){files.push("./dist/packed/"+file+".bundle.min.js")});var deferred=$q.defer();return $ocLazyLoad.load(files).then(function(){$timeout(function(){deferred.resolve(!0)},1)}),deferred.promise}]}},CURRENT_LANGUAGE="en";let setupLanguage=function(){var storageLanguage=localStorage.getItem("pwa-cache-"+APP_KEY+"/registry-index/sb-current-language");if(null!==storageLanguage)storageLanguage=storageLanguage.replace(/"/g,""),AVAILABLE_LANGUAGES.indexOf(storageLanguage)>=0&&(CURRENT_LANGUAGE=storageLanguage);else if(navigator.language){let tmpLanguage=navigator.language.replace("-","_");try{AVAILABLE_LANGUAGES.indexOf(tmpLanguage)>=0?CURRENT_LANGUAGE=tmpLanguage:AVAILABLE_LANGUAGES.indexOf(tmpLanguage.split("_")[0])>=0&&(CURRENT_LANGUAGE=tmpLanguage.split("_")[0])}catch(e){console.error('[Language] fallback to "en" due to navigator.language error.'),CURRENT_LANGUAGE="en"}localStorage.setItem("pwa-cache-"+APP_KEY+"/registry-index/sb-current-language",'"'+CURRENT_LANGUAGE+'"')}};setupLanguage(),angular.module("lodash",[]).factory("_",["$window",function($window){return $window._}]);var semver={compare:function(a,b,specificity){for(var pa=a.split("."),pb=b.split("."),sentinels={major:1,minor:2,patch:3},i=0;i<(sentinels[specificity]||3);i++){if(na=Number(pa[i]),nb=Number(pb[i]),na>nb||!isNaN(na)&&isNaN(nb))return 1;if(na<nb||isNaN(na)&&!isNaN(nb))return-1}return 0},isGreater:function(a,b,specificity){return 1===this.compare(a,b,specificity)},isLess:function(a,b,specificity){return-1===this.compare(a,b,specificity)},isEqual:function(a,b,specificity){return 0===this.compare(a,b,specificity)}},App=angular.module("starter",["ionic","lodash","ngRoute","ngCordova","ngSanitize","ngQueue","ion-gallery","ngImgCrop","ionic-zoom-view","templates","oc.lazyLoad"]).constant("$ionicLoadingConfig",{template:"<ion-spinner></ion-spinner>"}).constant("SB",{EVENTS:{AUTH:{loginSuccess:"auth-login-success",logoutSuccess:"auth-logout-success",registerSuccess:"auth-register-success",editSuccess:"auth-edit-success"},CACHE:{pagesReload:"pages-reload",layoutReload:"layout-reload",clearSocialGaming:"clear-cache-socialgaming",clearDiscount:"clear-cache-discount"},PADLOCK:{unlockFeatures:"padlock-unlock-features",lockFeatures:"padlock-lock-features"},PUSH:{notificationReceived:"push-notification-received",unreadPush:"push-get-unreaded",readPush:"push-mark-as-read"},MEDIA_PLAYER:{HIDE:"media-player-hide",SHOW:"media-player-show"}},DEVICE:{TYPE_ANDROID:1,TYPE_IOS:2,TYPE_BROWSER:3}}).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",logoutSuccess:"auth-logout-success",loginStatusChanged:"auth-login-status-changed",notAuthenticated:"auth-not-authenticated"}).constant("CACHE_EVENTS",{clearSocialGaming:"clear-cache-socialgaming",clearDiscount:"clear-cache-discount"}).constant("PADLOCK_EVENTS",{unlockFeatures:"padlock-unlock-features"}).constant("PUSH_EVENTS",{notificationReceived:"push-notification-received",unreadPushs:"push-get-unreaded",readPushs:"push-mark-as-read"}).config(function($compileProvider,$httpProvider,$ionicConfigProvider,$logProvider){$httpProvider.interceptors.push(function($injector,$log,$q,$session){return{request:function(config){var sessionId=$session.getId();return!1!==sessionId&&-1===config.url.indexOf(".html")&&config.url.indexOf(DOMAIN)>-1&&!0!==config.noSbToken&&(config.headers["XSB-AUTH"]=sessionId),config},responseError:function(response){return response.config.url.match(/(templates|layout\/home)\/.*\.html$/)&&"templates/home/l6/view.html"!==response.config.url?($log.debug("System: An error occured while loading your Layout template, fallback on Layout 6."),response.config.url="templates/home/l6/view.html",$injector.get("$pwaRequest")(response.config)):$q.reject(response)}}}),$logProvider.debugEnabled(DEBUG),$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|map|geo|skype|tel|file|smsto):/),$compileProvider.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|blob|ionic):|data:image/),$httpProvider.defaults.withCredentials=!0,$ionicConfigProvider.views.swipeBackEnabled(!1),$ionicConfigProvider.backButton.text(""),$ionicConfigProvider.backButton.previousTitleText(!1)}).run(function($injector,$ionicConfig,$ionicHistory,$ionicNavBarDelegate,$ionicPlatform,$ionicPopup,$ionicScrollDelegate,$ionicSlideBoxDelegate,$location,$log,$ocLazyLoad,$pwaRequest,$q,$rootScope,$session,$state,$templateCache,$timeout,$translate,$window,AdmobService,Analytics,Application,Customer,Codescan,Dialog,Facebook,FacebookConnect,Padlock,Pages,Push,PushService,SB,InAppLinks){angular.extend($rootScope,{isNativeApp:IS_NATIVE_APP,isOnline:!0,isOffline:!1,card_design:!1,app_is_loaded:!0,app_is_bo_locked:!1,ui_background_loader:!1,ui_progress_view:!1,loginFeatureBack:!0}),IS_PREVIEW&&($rootScope.previewerNotice=!0),$window.addEventListener("online",function(){$log.info("online"),$rootScope.isOnline=!0,$rootScope.isOffline=!1}),$window.addEventListener("offline",function(){$log.info("offline"),$rootScope.isOnline=!1,$rootScope.isOffline=!0}),$rootScope.openLoaderProgress=function(){$rootScope.ui_background_loader=!1,$rootScope.ui_progress_view=!0},$rootScope.closeLoaderProgress=function(){$rootScope.ui_background_loader=!1,$rootScope.ui_progress_view=!1},$rootScope.backgroundLoaderProgress=function(){$rootScope.ui_background_loader=!0,$rootScope.ui_progress_view=!1},$rootScope.isNotAvailableOffline=function(){return!!$rootScope.isOffline&&(Dialog.alert("Offline mode","This feature is not available in offline mode!","Dismiss",2350),!0)},$rootScope.isNotAvailableInOverview=function(){return!!isOverview&&(Dialog.alert("Overview","This feature is disabled in this preview","Dismiss",-1),!0)},$ionicPlatform.ready(function(){$ionicNavBarDelegate.align("center"),$timeout(function(){$ionicNavBarDelegate.showBar(!1)});var loadApp=function(refresh){$window.cordova=$window.cordova||{},$window.device=$window.device||{};var networkPromise=$q.defer();$session.loaded.then(function(){var deviceScreen=$session.getDeviceScreen();$pwaRequest.post("front/app/init",{data:{add_language:!0,device_uid:$session.getDeviceUid(),device_width:deviceScreen.width,device_height:deviceScreen.height,user_language:CURRENT_LANGUAGE,version:"4.19.1"},timeout:2e4,cache:!isOverview,refresh:refresh,network_promise:networkPromise}).then(function(data){var load=data.loadBlock,manifest=data.manifestBlock;$translate.translations=data.translationBlock,$session.getId()||$session.setId(data.loadBlock.customer.token),Application.populate(data.loadBlock),$ionicConfig.backButton.icon("none"),Customer.populate(data.loadBlock.customer),Customer.setFacebookLogin(data.loadBlock.application.facebook),Pages.populate(data.featureBlock),LOGIN_FB&&Customer.loginWithFacebook(fbtoken);var HomepageLayout=$injector.get("HomepageLayout");if(data.cssBlock&&data.cssBlock.css){var css=document.createElement("style");css.setAttribute("type","text/css"),css.innerHTML=data.cssBlock.css,document.body.appendChild(css)}if(!$rootScope.isOverview&&!$rootScope.isNativeApp){var head=angular.element(document.querySelector("head"));manifest.iconUrl&&(head.append('<link rel="apple-touch-icon" href="'+manifest.iconUrl+'" />'),head.append('<link rel="icon" sizes="192x192" href="'+manifest.iconUrl+'" />')),manifest.manifestUrl&&head.append('<link rel="manifest" href="'+DOMAIN+manifest.manifestUrl+'">'),manifest.startupImageUrl&&head.append('<link rel="apple-touch-startup-image" href="'+manifest.startupImageUrl+'" />'),manifest.themeColor&&head.append('<meta name="theme-color" content="'+manifest.themeColor+'" />')}if(IS_PREVIEW||($rootScope.fetchupdatetimer=null,$ionicPlatform.on("resume",function(resumeResult){$timeout.cancel($rootScope.fetchupdatetimer),$log.info("-- app is resumed --"),Analytics.storeOpening().then(function(result){Analytics.data.storeClosingId=result.id}),$rootScope.onPause=!1}),$rootScope.onPause=!1,$ionicPlatform.on("pause",function(pauseResult){if($rootScope.onPause=!0,Analytics.storeClosing(),!data.loadBlock.application.disableUpdates){var runChcp=function(){var watcherChcp=function(){"undefined"!=typeof chcp&&(localStorage.getItem(!1)?chcp.isUpdateAvailableForInstallation(function(error,data){if(error)return $log.info("AutoUpdate: Nothing to install"),void $log.info("AutoUpdate: "+error.description);$log.info("AutoUpdate: Current version: "+data.currentVersion),$log.info("AutoUpdate: About to install: "+data.readyToInstallVersion),chcp.installUpdate(function(error){error&&($log.info("AutoUpdate: Something went wrong with the update, will retry later."),$log.info("AutoUpdate: "+error.description))})}):chcp.fetchUpdate(function(error,data){error?(2===error.code?$log.info("AutoUpdate: There is no available update."):$log.info("AutoUpdate: Failed to load the update with error code: "+error.code),$log.info("AutoUpdate: "+error.description),localStorage.setItem("install-update",!1)):($log.info("AutoUpdate: Update success, trying to install."),$log.info("AutoUpdate: Current version: "+data.currentVersion),$log.info("AutoUpdate: About to install: "+data.readyToInstallVersion),chcp.installUpdate(function(error){error?($log.info("AutoUpdate: Something went wrong with the update, will retry later."),$log.info("AutoUpdate: "+error.description)):($log.info("AutoUpdate: Update successfully install, restarting new files."),localStorage.setItem("install-update",!1))}))})),$rootScope.fetchupdatetimer=$timeout(watcherChcp,36e5)};watcherChcp()};$ocLazyLoad.load("./features/previewer/previewer.bundle.min.js").then(function(){try{$injector.get("Previewer").fileExists(function(){console.info("[PREVIEWER] Preview in progress, aborting.")},function(){console.info("[PREVIEWER] No previewer loaded, continue."),runChcp()})}catch(e){console.log("[PREVIEWER - WARNING] "+e.message),runChcp()}}).catch(function(error){runChcp()})}})),load.application.is_bo_locked&&($rootScope.app_is_bo_locked=!0,$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("locked")),void 0!==window.StatusBar)switch(DEVICE_TYPE){case SB.DEVICE.TYPE_ANDROID:!0===load.application.androidStatusBarIsHidden&&window.StatusBar.hide();break;case SB.DEVICE.TYPE_IOS:!0===load.application.iosStatusBarIsHidden&&window.StatusBar.hide()}$rootScope.isNativeApp&&($window.localStorage.getItem("first_running")||($window.localStorage.setItem("first_running","true"),Analytics.storeInstallation())),Analytics.storeOpening().then(function(result){result&&result.id&&(Analytics.data.storeClosingId=result.id)}),$rootScope.app_is_locked=Application.is_locked&&!(Customer.can_access_locked_features||Padlock.unlocked_by_qrcode),$window.colors=load.application.colors,void 0!==window.StatusBar&&window.updateStatusBar($window.colors.header.statusBarColor),load.application.facebook.id&&(FacebookConnect.permissions=Array.isArray(load.application.facebook.scope)?load.application.facebook.scope:[load.application.facebook.scope],FacebookConnect.app_id=load.application.facebook.id);try{AdmobService.init(load.application.admob)}catch(error){$log.error("Unable to initialize AdMob.",error)}Customer.isLoggedIn()?$rootScope.$broadcast(SB.EVENTS.AUTH.loginSuccess):$rootScope.$broadcast(SB.EVENTS.AUTH.logoutSuccess),$rootScope.getTargetForLink=function(){return $rootScope.isNativeApp?"_blank":"_system"},$ionicNavBarDelegate.align("center"),$timeout(function(){$ionicNavBarDelegate.showBar(!1)}),$rootScope.$on("$ionicView.loaded",function(event,loadViewData){"home"!==loadViewData.stateName?$timeout(function(){$ionicNavBarDelegate.showBar(!0)},100):$timeout(function(){$ionicNavBarDelegate.showBar(!!HomepageLayout.properties.options.autoSelectFirst)},100)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toStateParams,fromState,fromStateParams){parent&&"function"==typeof parent.postMessage&&parent!==window&&parent.postMessage("state.go",DOMAIN)}),$rootScope.$on("$stateChangeStart",function(event,toState,toStateParams,fromState,fromStateParams){$rootScope.app_is_locked=Application.is_locked&&!(Customer.can_access_locked_features||Padlock.unlocked_by_qrcode),$rootScope.app_is_locked&&"padlock-view"!==toState.name?(event.preventDefault(),$state.go("padlock-view")):Customer.can_access_locked_features&&"padlock-view"===toState.name&&event.preventDefault()}),InAppLinks.listen(),$rootScope.$on(SB.EVENTS.AUTH.loginSuccess,function(){$rootScope.app_is_locked=Application.is_locked&&!(Customer.can_access_locked_features||Padlock.unlocked_by_qrcode),!$rootScope.app_is_locked&&Application.is_locked&&$state.go("home")}),$rootScope.$on(SB.EVENTS.AUTH.logoutSuccess,function(){$rootScope.app_is_locked=Application.is_locked&&!Padlock.unlocked_by_qr_code,$rootScope.app_is_locked&&($ionicHistory.nextViewOptions({disableBack:!0}),$state.go("padlock-view"))}),$rootScope.$on("$ionicView.beforeEnter",function(){Analytics.storeClosing()}),$rootScope.unlockUpdate=0,$rootScope.checkForUpdate=function(){data.loadBlock.application.disableUpdates?$log.info("Stop update, feature is disabled."):$rootScope.isNativeApp?IS_PREVIEW?$log.info("Stop update, This an App preview."):$rootScope.unlockUpdate<4?$rootScope.unlockUpdate=$rootScope.unlockUpdate+1:($rootScope.unlockUpdate=0,Dialog.alert("AutoUpdate","Checking for update ...","OK",-1),chcp.fetchUpdate(function(fetchUpdateError,fetchUpdateData){fetchUpdateError?($log.info("AutoUpdate: Failed to load the update with error code: "+fetchUpdateError.code),2===fetchUpdateError.code?Dialog.alert("AutoUpdate","There is no available update.","Dismiss",-1):Dialog.alert("AutoUpdate",fetchUpdateError.description,"Dismiss",-1)):Dialog.alert("AutoUpdate","Successfully downloaded update, installing...","Dismiss",-1).then(function(){$log.info("AutoUpdate: Current version: "+fetchUpdateData.currentVersion),$log.info("AutoUpdate: About to install: "+fetchUpdateData.readyToInstallVersion),chcp.installUpdate(function(installUpdateError){installUpdateError?($log.info("AutoUpdate: Something went wrong with the update, will retry later.",-1),Dialog.alert("AutoUpdate",installUpdateError.description,"Dismiss")):Dialog.alert("AutoUpdate","Update successfully installed, restarting new files.","Dismiss",-1)})})})):$log.info("Stop update, Android or iOS is required.")},$rootScope.isOverview=isOverview,$rootScope.isOverview&&($window.overview={features:{}},$window.isHomepage=function(){return $location.path()===BASE_PATH},$window.clearCache=function(url){$templateCache.remove(BASE_PATH+"/"+url)},$window.reload=function(path){path&&path!==$location.path()||($ionicHistory.clearCache(),$state.reload())},$window.reloadTabbar=function(){HomepageLayout.unsetData()},$window.setPath=function(path,replace){$window.isSamePath(path)?$window.reload():path.length&&$timeout(function(){$location.path(path),replace&&$location.replace()})},$window.getPath=function(){return $location.path()},$window.isSamePath=function(path){return $location.path()===path},$window.showHomepage=function(){"homepage"===HomepageLayout.properties.menu.visibility?$window.setPath(BASE_PATH):HomepageLayout.getFeatures().then(function(features){$ionicHistory.nextViewOptions({historyRoot:!0,disableAnimate:!1});for(var visibleOptions=features.options.filter(function(option){return option.is_visible}),fi=0;fi<visibleOptions.length;fi+=1){var feat=visibleOptions[fi];if(["code_scan","radio","padlock","tabbar_account"].indexOf(feat.code)>=0){fi;break}}visibleOptions[fi]&&$window.setPath(visibleOptions[fi].path,!0)})},$window.back=function(){$ionicHistory.goBack()},$window.setLayoutId=function(valueId,layoutId){HomepageLayout.setLayoutId(valueId,layoutId)},parent&&"function"==typeof parent.postMessage&&parent!==window&&parent.postMessage("overview.loaded",DOMAIN)),$rootScope.onlineOnly=$rootScope.isNotAvailableOffline,$rootScope.showMobileFeatureOnlyError=$rootScope.isNotAvailableInOverview,Application.loaded=!0,networkPromise.promise.then(function(networkPromiseResult){Pages.populate(networkPromiseResult.featureBlock),$rootScope.$broadcast(SB.EVENTS.CACHE.layoutReload)},function(){}).then(function(){$timeout(function(){Application.preLoad(Pages.data.pages)},100)}),$ocLazyLoad.load("./dist/lazy/moment.min.js").then(function(){window.momentjs_loaded=!0;try{var tmpLang=language.replace("_","-").toLowerCase();moment.locale([tmpLang,"en"])}catch(e){moment.locale("en")}}),$ocLazyLoad.load("./dist/lazy/angular-carousel.min.js"),window.Features.featuresToLoadOnStart.forEach(function(bundle){$ocLazyLoad.load([bundle.path],{cache:!1}).then(function(success){if($injector.has(bundle.factory))try{$injector.get(bundle.factory).onStart()}catch(e){console.log(e,e.message)}}).catch(function(error){})});var currentState=$ionicHistory.currentStateName();if($rootScope.app_is_locked&&"padlock-view"!==currentState&&$state.go("padlock-view"),IS_PREVIEW)$timeout(function(){$rootScope.previewerNotice=!1},3e3),$window.registerTap(3,function(){try{$ocLazyLoad.load("./features/previewer/previewer.bundle.min.js").then(function(){$injector.get("Previewer").deleteFile()})}catch(e){}$window.webview.close()});else try{$timeout(function(){PushService.configure(load.application.fcmSenderID,load.application.pushIconcolor),PushService.register()},500)}catch(e){console.error("An error occured while registering device for Push.",e.message)}}).catch(function(error){!0===refresh&&$timeout(loadApp(!1),1)})})};$timeout(loadApp(!0),1)})});